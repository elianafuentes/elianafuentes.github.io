
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>EDA BITCOIN &#8212; Proyecto Bitcoin</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/notebook';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Predicción del Precio de Bitcoin con Modelos de Machine Learning" href="../intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.avif" class="logo__image only-light" alt="Proyecto Bitcoin - Home"/>
    <img src="../_static/logo.avif" class="logo__image only-dark pst-js-only" alt="Proyecto Bitcoin - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Predicción del Precio de Bitcoin con Modelos de Machine Learning
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">EDA BITCOIN</a></li>













</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/notebook.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>EDA BITCOIN</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">EDA BITCOIN</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#que-es-bitcoin">¿Qué es BITCOIN?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descripcion-de-los-datos">Descripción de los datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objetivo-del-analisis">Objetivo del análisis</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-datos-bitcoin">Análisis exploratorio de datos - BITCOIN</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-preliminar">Análisis preliminar</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizacion-de-la-serie">Visualización de la serie</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizacion-temporal">Visualización temporal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-la-volatilidad-intradia">Análisis de la volatilidad intradía</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretacion-del-precio-de-cierre-y-volumen-de-bitcoin">Interpretación del Precio de Cierre y Volumen de Bitcoin</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-estacionalidad-y-periodicidad-frecuencia-1-dia">Análisis de Estacionalidad y Periodicidad (Frecuencia: 1 día)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deteccion-de-anomalias">Detección de Anomalías</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-tendencia">Análisis de tendencia</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-autocorrelacion">Análisis de autocorrelación</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-estacionaridad">Análisis de Estacionaridad</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacion-de-datos">Transformación de datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-estacionaridad-variables-predictoras">Análisis de estacionaridad variables predictoras</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones-finales-eda">Conclusiones finales EDA</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementacion-de-modelos">Implementación de Modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prediccion-del-precio-de-cierre-del-bitcoin-frecuencia-15-min">Predicción del Precio de Cierre del Bitcoin (Frecuencia: 15 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacion-de-modelos-benchmark">Aplicacion de modelos BenchMark</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preparacion-de-los-datos">Preparacion de los datos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enriquecimiento-del-dataframe-transformar-features-temporales">1. Enriquecimiento del DataFrame: <code class="docutils literal notranslate"><span class="pre">transformar_features_temporales()</span></code></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nearest-neighbors-knn">K-Nearest Neighbors (KNN)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion-general">Definición General</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caracteristicas-clave">Características Clave</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacion-matematica">Aplicación Matemática</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas-de-distancia-comunes">Métricas de Distancia Comunes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizacion-para-knn">Optimización para KNN</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-regression">Ridge Regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion">Definición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#intuicion">Intuición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caracteristicas">Características</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solucion-cerrada">Solución cerrada</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacion">Aplicación</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso-regression-regresion-l1">Lasso Regression (Regresión L1)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Definición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Intuición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Características clave</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizacion-matematica-con-solver-saga-para-ridge-y-lasso">Optimización matemática con solver ‘saga’ para Ridge y Lasso</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#que-es-saga">¿Qué es ‘saga’?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#formulacion-general-del-problema-optimizado">Formulación general del problema optimizado</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-penalizacion-l2">Ridge (penalización L2):</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso-penalizacion-l1">Lasso (penalización L1):</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#que-optimiza-saga">¿Qué optimiza SAGA?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ventajas-del-solver-saga">Ventajas del solver ‘saga’:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-regression">Random Forest Regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Definición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prediccion">Predicción</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Características</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGboost</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost-regressor-definicion-matematica">XGBoost Regressor: Definición Matemática</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#objetivo-del-modelo">Objetivo del modelo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-objetivo">Función objetivo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aproximacion-de-segundo-orden-expansion-de-taylor">Aproximación de segundo orden (expansión de Taylor)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ventajas-clave">Ventajas clave</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizacion-de-xgboost-tree-method-hist-y-early-stopping-rounds">Optimización de XGBoost: <code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code> y <code class="docutils literal notranslate"><span class="pre">early_stopping_rounds</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-method-hist-boosting-con-histogramas">1. <code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code>: Boosting con histogramas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proceso-matematico">Proceso matemático:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#early-stopping-rounds-detencion-temprana">2. <code class="docutils literal notranslate"><span class="pre">early_stopping_rounds</span></code>: Detención temprana</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criterio-formal">Criterio formal:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusión:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#support-vector-regression-svr">Support Vector Regression (SVR)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Definición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#formulacion-matematica">Formulación matemática</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Intuición</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados">Resultados</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparacion-final-de-modelos">Comparación Final de Modelos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#justificacion-del-modelo-final">Justificación del modelo final</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#por-que-los-p-valores-de-ljung-box-son-nan">¿Por qué los p-valores de Ljung-Box son NaN?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#propuesta-de-modelo">Propuesta de Modelo</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#propuesta-ensemble-ridge-rf-xgboost-para-prediccion-del-precio-de-bitcoin">Propuesta: Ensemble Ridge + RF + XGBoost para Predicción del Precio de Bitcoin</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducción</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fundamentacion-teorica">Fundamentación Teórica</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-regression-l2">1. Ridge Regression (L2)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">2. Random Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">3. XGBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-del-modelo-ensemble">Estructura del Modelo Ensemble</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-obtenidos">Resultados Obtenidos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretacion">Interpretación</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#como-se-interpreta-esto">¿Cómo se interpreta esto?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#por-que-el-modelo-sigue-siendo-valido">¿Por qué el modelo sigue siendo válido?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Conclusión</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-general">Conclusión General</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="eda-bitcoin">
<h1>EDA BITCOIN<a class="headerlink" href="#eda-bitcoin" title="Link to this heading">#</a></h1>
<section id="que-es-bitcoin">
<h2>¿Qué es BITCOIN?<a class="headerlink" href="#que-es-bitcoin" title="Link to this heading">#</a></h2>
<p>Bitcoin (BTC) es una criptomoneda, es decir, una moneda digital descentralizada que funciona sin la necesidad de un banco central. Se basa en tecnología blockchain, un libro contable público y distribuido donde se registran todas las transacciones. Su precio es altamente volátil debido a la oferta y demanda, noticias económicas, regulaciones y otros factores externos.</p>
</section>
<section id="descripcion-de-los-datos">
<h2>Descripción de los datos<a class="headerlink" href="#descripcion-de-los-datos" title="Link to this heading">#</a></h2>
<p>El dataset contiene datos financieros históricos del mercado de Bitcoin con frecuencias de: 1 hora, 4 horas, 1dia y 15 minutos; cubriendo el periodo desde el 1 de enero de 2018 hasta 6 de febrero de 2025. Los datos permiten analizar el comportamiento de precios y volúmenes de Bitcoin, incluyendo tendencias, volatilidad y actividad del mercado. Contiene las siguientes variables:</p>
<ul class="simple">
<li><p>Precio de apertura (Open): El precio al que Bitcoin comenzó a cotizar en un periodo determinado (15 min, 1h,  4h o 1d).</p></li>
<li><p>Precio de cierre (Close): El último precio registrado en ese mismo periodo.</p></li>
<li><p>Máximo y mínimo (High &amp; Low): Los valores más alto y más bajo de Bitcoin en ese periodo.</p></li>
<li><p>Volumen (Volume): La cantidad total de Bitcoin negociado.</p></li>
<li><p>Quote asset volume: Volumen total de transacciones expresado en el activo cotizado (USD).</p></li>
<li><p>Number of trades: Número total de transacciones realizadas en el periodo.</p></li>
<li><p>Taker buy base asset volume: Volumen de compra por los compradores (takers) expresado en el activo base (Bitcoin).</p></li>
<li><p>Taker buy quote asset volume: Volumen de compra por los compradores (takers) expresado en el activo cotizado (USD).</p></li>
<li><p>Retorno (Return): La variación porcentual del precio entre periodos consecutivos.</p></li>
<li><p>Volatilidad: Una medida de qué tan variable es el precio en un periodo de tiempo.</p></li>
</ul>
</section>
<section id="objetivo-del-analisis">
<h2>Objetivo del análisis<a class="headerlink" href="#objetivo-del-analisis" title="Link to this heading">#</a></h2>
<p>El objetivo de este EDA es comprender la estructura de los datos de Bitcoin, identificar patrones temporales (tendencia, estacionalidad, ciclos), detectar anomalías y preparar los datos para la aplicación de modelos predictivos o de pronóstico.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analisis-exploratorio-de-datos-bitcoin">
<h1>Análisis exploratorio de datos - BITCOIN<a class="headerlink" href="#analisis-exploratorio-de-datos-bitcoin" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.stattools</span><span class="w"> </span><span class="kn">import</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">acf</span><span class="p">,</span> <span class="n">pacf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.seasonal</span><span class="w"> </span><span class="kn">import</span> <span class="n">seasonal_decompose</span>  <span class="c1"># Importación corregida</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.graphics.tsaplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeSeriesSplit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">jarque_bera</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cargat datos</span>

<span class="n">data_folder</span> <span class="o">=</span> <span class="s2">&quot;BTCBinance&quot;</span>

<span class="c1"># Archivos específicos a leer</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;1d&quot;</span><span class="p">:</span> <span class="s2">&quot;btc_1d_data_2018_to_2025.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4h&quot;</span><span class="p">:</span> <span class="s2">&quot;btc_4h_data_2018_to_2025.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1h&quot;</span><span class="p">:</span> <span class="s2">&quot;btc_1h_data_2018_to_2025.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;15m&quot;</span><span class="p">:</span> <span class="s2">&quot;btc_15m_data_2018_to_2025.csv&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Leer los datasets y procesarlos</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>  <span class="c1"># Ruta completa</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Open time&quot;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;Open time&quot;</span><span class="p">)</span>  <span class="c1"># Leer con fecha como índice</span>
    <span class="n">dfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Open&quot;</span><span class="p">,</span> <span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="s2">&quot;Volume&quot;</span><span class="p">]]</span>  <span class="c1"># Mantener columnas relevantes</span>
    
    <span class="c1"># Eliminar columna &quot;Ignore&quot; y seleccionar columnas relevantes</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Ignore&quot;</span><span class="p">])</span>  <span class="c1"># Eliminar columna</span>
    <span class="n">dfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Open&quot;</span><span class="p">,</span> <span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="s2">&quot;Volume&quot;</span><span class="p">]]</span>  <span class="c1"># Mantener columnas clave</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">17</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>  <span class="c1"># Ruta completa</span>
<span class="ne">---&gt; </span><span class="mi">17</span>     <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Open time&quot;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;Open time&quot;</span><span class="p">)</span>  <span class="c1"># Leer con fecha como índice</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">dfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Open&quot;</span><span class="p">,</span> <span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="s2">&quot;Volume&quot;</span><span class="p">]]</span>  <span class="c1"># Mantener columnas relevantes</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="c1"># Eliminar columna &quot;Ignore&quot; y seleccionar columnas relevantes</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py:912,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">    </span><span class="mi">899</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">900</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">901</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">910</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">912</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py:577,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">577</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">580</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py:1407,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1404</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1406</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1407</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/pandas/io/parsers/readers.py:1661,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1659</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1660</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1661</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1662</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1663</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1664</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1665</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1666</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1667</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1668</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1669</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1670</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1671</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1672</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/pandas/io/common.py:859,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">854</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">855</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">856</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">857</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">859</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">863</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">867</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;BTCBinance/btc_1d_data_2018_to_2025.csv&#39;
</pre></div>
</div>
</div>
</div>
<section id="analisis-preliminar">
<h2>Análisis preliminar<a class="headerlink" href="#analisis-preliminar" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Inspección general.</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frecuencia: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dimensiones: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Primeras filas:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Últimas filas:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Valores faltantes por columna:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Frecuencia: 1d
Dimensiones: (2594, 5)
Primeras filas:
                Open      High       Low     Close        Volume
Open time                                                       
2018-01-01  13715.65  13818.55  12750.00  13380.00   8609.915844
2018-01-02  13382.16  15473.49  12890.02  14675.11  20078.092111
2018-01-03  14690.00  15307.56  14150.00  14919.51  15905.667639
2018-01-04  14919.51  15280.00  13918.04  15059.54  21329.649574
2018-01-05  15059.56  17176.24  14600.00  16960.39  23251.491125
Últimas filas:
                 Open       High        Low      Close       Volume
Open time                                                          
2025-02-02  100635.66  101456.60   99747.59   99796.00   3149.62233
2025-02-03   97700.59   97782.79   91231.00   94495.21  20992.95572
2025-02-04  101328.51  101660.94  100743.33  101367.77   1910.35542
2025-02-05   97763.14   98930.44   97131.43   97589.30   8160.56795
2025-02-06   96612.44   99120.00   96430.78   98329.13   8315.06445
Valores faltantes por columna:
Open      0
High      0
Low       0
Close     0
Volume    0
dtype: int64
------------------------------
Frecuencia: 4h
Dimensiones: (15543, 5)
Primeras filas:
                         Open      High       Low     Close       Volume
Open time                                                               
2018-01-01 00:00:00  13715.65  13715.65  13155.38  13410.03  1676.204807
2018-01-01 04:00:00  13434.98  13818.55  13322.15  13570.35  1302.214836
2018-01-01 08:00:00  13569.98  13735.24  13001.13  13220.56  1319.755931
2018-01-01 12:00:00  13220.56  13330.00  12750.00  13247.00  1831.933153
2018-01-01 16:00:00  13247.00  13290.65  12940.00  13240.37  1092.337234
Últimas filas:
                         Open      High       Low     Close      Volume
Open time                                                              
2025-02-05 08:00:00  97864.43  98256.00  97257.05  98198.00  3128.59694
2025-02-05 12:00:00  98198.00  99149.00  97734.69  98116.24  5192.00486
2025-02-05 16:00:00  98116.24  98277.02  96500.00  97370.00  4822.00148
2025-02-05 20:00:00  97370.00  97706.37  96155.00  96612.43  5817.81518
2025-02-06 00:00:00  96612.44  97493.07  96430.78  97355.67  2552.15194
Valores faltantes por columna:
Open      0
High      0
Low       0
Close     0
Volume    0
dtype: int64
------------------------------
Frecuencia: 1h
Dimensiones: (62111, 5)
Primeras filas:
                         Open      High       Low     Close      Volume
Open time                                                              
2018-01-01 00:00:00  13715.65  13715.65  13400.01  13529.01  443.356199
2018-01-01 01:00:00  13528.99  13595.89  13155.38  13203.06  383.697006
2018-01-01 02:00:00  13203.00  13418.43  13200.00  13330.18  429.064572
2018-01-01 03:00:00  13330.26  13611.27  13290.00  13410.03  420.087030
2018-01-01 04:00:00  13434.98  13623.29  13322.15  13601.01  340.807329
Últimas filas:
                         Open      High       Low     Close      Volume
Open time                                                              
2025-02-05 20:00:00  97370.00  97706.37  96870.39  97323.39  1258.92036
2025-02-05 21:00:00  97323.40  97532.61  96769.23  96904.11  1234.05224
2025-02-05 22:00:00  96904.11  97047.89  96241.12  96445.63  2445.99875
2025-02-05 23:00:00  96445.64  96853.57  96155.00  96612.43   878.84383
2025-02-06 00:00:00  96612.44  96999.26  96430.78  96826.96   983.47440
Valores faltantes por columna:
Open      0
High      0
Low       0
Close     0
Volume    0
dtype: int64
------------------------------
Frecuencia: 15m
Dimensiones: (248397, 5)
Primeras filas:
                         Open      High       Low     Close      Volume
Open time                                                              
2018-01-01 00:00:00  13715.65  13715.65  13400.01  13556.15  123.616013
2018-01-01 00:15:00  13533.75  13550.87  13402.00  13521.12   98.136430
2018-01-01 00:30:00  13500.00  13545.37  13450.00  13470.41   79.904037
2018-01-01 00:45:00  13494.65  13690.87  13450.00  13529.01  141.699719
2018-01-01 01:00:00  13528.99  13571.74  13402.28  13445.63   72.537533
Últimas filas:
                         Open      High       Low     Close     Volume
Open time                                                             
2025-02-05 23:00:00  96445.64  96824.80  96240.88  96714.02  357.74121
2025-02-05 23:15:00  96714.03  96853.57  96285.32  96327.51  163.73220
2025-02-05 23:30:00  96327.52  96641.06  96155.00  96584.95  211.05421
2025-02-05 23:45:00  96584.94  96665.81  96441.93  96612.43  146.31621
2025-02-06 00:00:00  96612.44  96815.63  96430.78  96732.14  279.01617
Valores faltantes por columna:
Open      0
High      0
Low       0
Close     0
Volume    0
dtype: int64
------------------------------
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Estadísticas descriptivas</span>
<span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">=== Estadísticas descriptivas (</span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s1">) ===&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=== Estadísticas descriptivas (1d) ===
                Open           High            Low          Close  \
count    2594.000000    2594.000000    2594.000000    2594.000000   
mean    29057.847182   29743.249383   28327.995451   29090.193446   
std     23539.635421   24046.515394   23021.304519   23576.229505   
min      3211.710000    3276.500000    3156.260000    3211.720000   
25%      9067.985000    9261.240000    8765.000000    9068.840000   
50%     22712.950000   23252.895000   22257.575000   22741.115000   
75%     43484.365000   44293.657500   42487.500000   43527.390000   
max    106143.820000  108353.000000  105321.490000  106143.820000   

              Volume  
count    2594.000000  
mean    70821.588903  
std     80473.318599  
min      1521.537318  
25%     29769.803371  
50%     44833.178030  
75%     73702.302851  
max    760705.362783  

=== Estadísticas descriptivas (4h) ===
                Open           High            Low          Close  \
count   15543.000000   15543.000000   15543.000000   15543.000000   
mean    29063.280668   29334.077876   28775.596838   29068.702379   
std     23531.883881   23732.467929   23322.094973   23537.982874   
min      3172.620000    3210.000000    3156.260000    3172.050000   
25%      9082.110000    9149.745000    8967.610000    9082.280000   
50%     22772.200000   22988.600000   22543.640000   22773.620000   
75%     43511.985000   43860.585000   43066.775000   43518.095000   
max    108239.190000  109588.000000  107093.330000  108239.190000   

              Volume  
count   15543.000000  
mean    11832.866537  
std     15081.813282  
min         5.887034  
25%      4276.162780  
50%      7066.940340  
75%     12596.614784  
max    284711.694213  

=== Estadísticas descriptivas (1h) ===
                Open           High            Low          Close  \
count   62111.000000   62111.000000   62111.000000   62111.000000   
mean    29072.894562   29205.147342   28933.700827   29074.221833   
std     23533.108494   23630.688047   23432.206585   23534.568925   
min      3172.620000    3184.750000    3156.260000    3172.050000   
25%      9084.980000    9122.230000    9041.000000    9085.015000   
50%     22784.860000   22895.400000   22670.220000   22785.320000   
75%     43500.860000   43694.435000   43297.850000   43502.445000   
max    108320.000000  109588.000000  107780.510000  108320.010000   

              Volume  
count   62111.000000  
mean     2961.369397  
std      4146.849702  
min         0.000000  
25%       966.645698  
50%      1642.736260  
75%      3134.395999  
max    137207.188600  

=== Estadísticas descriptivas (15m) ===
                Open           High            Low          Close  \
count  248397.000000  248397.000000  248397.000000  248397.000000   
mean    29074.231803   29138.729916   29007.225176   29074.566799   
std     23534.018801   23580.874018   23485.307403   23534.403528   
min      3166.110000    3174.780000    3156.260000    3167.070000   
25%      9086.540000    9103.730000    9066.380000    9086.620000   
50%     22794.360000   22848.560000   22737.490000   22794.370000   
75%     43500.540000   43600.000000   43397.050000   43501.020000   
max    108975.430000  109588.000000  108185.270000  108975.420000   

              Volume  
count  248397.000000  
mean      740.480636  
std      1131.293284  
min         0.000000  
25%       219.859070  
50%       388.084750  
75%       768.552930  
max     40371.405060  
</pre></div>
</div>
</div>
</div>
<p>El análisis de los datos de Bitcoin entre enero de 2018 y febrero de 2025 revela una volatilidad extrema y un crecimiento notable, con precios oscilando entre <span class="math notranslate nohighlight">\(3,156.26 y \)</span>108,353.00. Durante este período, el precio medio de cierre se situó en <span class="math notranslate nohighlight">\(29,090.19, con una elevada desviación estándar de \)</span>23,576.22, confirmando la importante variabilidad del mercado.</p>
<p>El volumen diario promedio alcanzó las 70,821 unidades, con máximos de 760,705 unidades en momentos de intensa actividad comercial. Los rendimientos diarios muestran un promedio de 0.14%, con caídas extremas de hasta -39.50% y alzas de hasta 19.53% en un solo día, mientras que la mediana positiva del 0.07% sugiere una tendencia general alcista a pesar de la volatilidad.</p>
<p>La comparación entre distintas frecuencias temporales (diaria, 4 horas y 1 hora) muestra consistencia en los valores medios y revela significativas fluctuaciones intradiarias, observándose además una distribución desigual del volumen a lo largo del día.</p>
</section>
<section id="visualizacion-de-la-serie">
<h2>Visualización de la serie<a class="headerlink" href="#visualizacion-de-la-serie" title="Link to this heading">#</a></h2>
<section id="visualizacion-temporal">
<h3>Visualización temporal<a class="headerlink" href="#visualizacion-temporal" title="Link to this heading">#</a></h3>
<p>Con el objetivo de observar la tendencia general y posibles anomalías.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gráfica de línea para el precio de cierre (solo fr de 1 día)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Precio de Cierre (frecuencia: 15 min)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre de Bitcoin (15 min)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre (USD)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8a514f09a594977ee71a8f1dae84db03f88ee64fad06fdc89cf55c4d0e30c300.png" src="../_images/8a514f09a594977ee71a8f1dae84db03f88ee64fad06fdc89cf55c4d0e30c300.png" />
</div>
</div>
<p>La gráfica del precio de cierre de Bitcoin en intervalos de 15 minutos, desde 2018 hasta principios de 2025, revela una serie de ciclos de mercado completos, cada uno influenciado por eventos específicos y factores externos. Durante este período, Bitcoin experimentó fases de consolidación, ciclos alcistas significativos y correcciones prolongadas, reflejando su naturaleza volátil y dinámica.</p>
<p>En 2018-2020, el precio se mantuvo en un rango relativamente bajo, con un mínimo cercano a los $3,000 a finales de 2018, marcando un período de consolidación después del máximo histórico de 2017. Este mercado bajista fue impulsado por la corrección posterior a la “cripto-manía” y la falta de adopción institucional en ese momento.</p>
<p>En 2021, se observó el primer ciclo alcista importante, con un rápido aumento desde 20,000 hasta superar los 60,000, impulsado por la adopción institucional (como las inversiones de Tesla y MicroStrategy), la expansión monetaria global debido a la pandemia de COVID-19, y el creciente interés minorista. Sin embargo, este ciclo fue seguido por una corrección significativa y un segundo intento de alcanzar máximos similares a finales de 2021.</p>
<p>El 2022 estuvo marcado por un mercado bajista prolongado, con el precio descendiendo gradualmente hasta estabilizarse alrededor de los $20,000 en 2023. Este período estuvo influenciado por factores macroeconómicos adversos, como el aumento de las tasas de interés y la inflación, así como por problemas en el ecosistema cripto, como el colapso de FTX.</p>
<p>A partir de finales de 2023 y durante 2024, se inició un nuevo ciclo alcista que superó significativamente los máximos anteriores, alcanzando más de $100,000 a principios de 2025. Este ciclo podría estar relacionado con el evento de reducción de emisión (halving) programado para 2024, la mayor adopción de Bitcoin como reserva de valor, y la mejora de la infraestructura del ecosistema cripto.</p>
<p>En resumen, esta gráfica no solo muestra la evolución del precio de Bitcoin, sino que también refleja la influencia de factores externos y la maduración del ecosistema cripto a lo largo del tiempo.</p>
</section>
<section id="analisis-de-la-volatilidad-intradia">
<h3>Análisis de la volatilidad intradía<a class="headerlink" href="#analisis-de-la-volatilidad-intradia" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular los retornos porcentuales y la volatilidad (desviación estándar de los retornos)</span>
<span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>  <span class="c1"># Retornos porcentuales</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Volatility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Return&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">672</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>  <span class="c1"># Calcular la volatilidad a partir de los retornos con una ventana de 672 periodos (7 días)</span>
    <span class="c1">#df_15m[&#39;Volatility&#39;] = df_15m[&#39;Return&#39;].rolling(window=672).std()  # Volatilidad (7 días)</span>

<span class="c1"># Visualizar la volatilidad para la frecuencia de 15 minutos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s1">&#39;Volatility&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Volatilidad (15 min)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Volatilidad del Precio de Bitcoin (15 minutos)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Volatilidad&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8ee94ce30ea772b5e33e1467220cc5cf1706795f19dc314aaf362fda5da03463.png" src="../_images/8ee94ce30ea772b5e33e1467220cc5cf1706795f19dc314aaf362fda5da03463.png" />
</div>
</div>
<p>La gráfica de volatilidad muestra cómo la variabilidad del precio de Bitcoin ha cambiado a lo largo del tiempo en intervalos de 15 minutos. Se observan picos de volatilidad que coinciden con eventos importantes en el mercado. Por ejemplo, en 2020, el halving de Bitcoin (mayo 2020) y la incertidumbre generada por la pandemia de COVID-19 provocaron un aumento significativo en la volatilidad. Durante 2021, la volatilidad también aumentó debido al rápido crecimiento del precio, impulsado por la adopción institucional y el interés minorista.</p>
<p>En 2022, la caída del precio y eventos como el colapso de FTX (noviembre 2022) generaron nuevos picos de volatilidad, reflejando la desconfianza en el ecosistema cripto. Por otro lado, los períodos de baja volatilidad, como en 2019 o 2023, suelen indicar momentos de consolidación o estabilidad en el mercado. Este análisis de volatilidad es crucial para entender los movimientos bruscos del precio y cómo reacciona el mercado ante eventos específicos.</p>
</section>
<section id="interpretacion-del-precio-de-cierre-y-volumen-de-bitcoin">
<h3>Interpretación del Precio de Cierre y Volumen de Bitcoin<a class="headerlink" href="#interpretacion-del-precio-de-cierre-y-volumen-de-bitcoin" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear una gráfica con dos ejes (precio y volumen)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Eje izquierdo: Precio de cierre</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Precio de Cierre (15 min)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre (USD)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>

<span class="c1"># Eje derecho: Volumen</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s1">&#39;Volume&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Volumen (15 min)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Volumen&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre y Volumen de Bitcoin (15 minutos)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3bb3e60dff7333868cf5942b323640a67528f439598ced4aee195ff9eaa428cd.png" src="../_images/3bb3e60dff7333868cf5942b323640a67528f439598ced4aee195ff9eaa428cd.png" />
</div>
</div>
<p>La gráfica que combina el precio de cierre y el volumen de transacciones permite analizar la relación entre ambos. Los picos de precio acompañados de un aumento en el volumen sugieren que el movimiento está respaldado por una mayor actividad comercial. Por ejemplo, en 2021, los máximos históricos de Bitcoin (alrededor de 64,000 en abril  y 69,000 en noviembre) coincidieron con aumentos significativos en el volumen, lo que indica una fuerte participación del mercado. Por el contrario, en 2022, la caída del precio también estuvo acompañada de un volumen elevado, especialmente durante el colapso de FTX, lo que refleja una intensa actividad de venta. En algunos casos, se observan movimientos de precio con bajo volumen, lo que podría indicar una falta de solidez en el movimiento o posibles manipulaciones del mercado. Esta relación entre precio y volumen es crucial para entender la dinámica del mercado y confirmar la validez de los movimientos de precio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definir eventos clave</span>
<span class="n">eventos</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Halving 2020&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-05-11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Máximo histórico 2021&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-04-14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Colapso de FTX&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-11-11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Halving 2024&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-04-20&quot;</span>  <span class="c1"># Fecha estimada</span>
<span class="p">}</span>

<span class="c1"># Graficar precio de cierre con eventos marcados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Precio de Cierre (15 min)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">evento</span><span class="p">,</span> <span class="n">fecha</span> <span class="ow">in</span> <span class="n">eventos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">fecha</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">evento</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre de Bitcoin con Eventos Clave (15 minutos)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre (USD)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1fff36bc11fe96918f647f26f2af8b2dd6de57778684f5ae561831736bb0353f.png" src="../_images/1fff36bc11fe96918f647f26f2af8b2dd6de57778684f5ae561831736bb0353f.png" />
</div>
</div>
<p>La gráfica que incluye eventos clave muestra cómo estos han influido en el comportamiento del precio de Bitcoin. El halving de 2020 marcó el inicio de un ciclo alcista, mientras que el colapso de FTX en 2022 generó una caída brusca en el precio. El próximo halving de 2024 podría marcar el inicio de un nuevo ciclo alcista. Estos eventos clave son fundamentales para entender los movimientos del precio y la dinámica del mercado de Bitcoin.</p>
</section>
<section id="analisis-de-estacionalidad-y-periodicidad-frecuencia-1-dia">
<h3>Análisis de Estacionalidad y Periodicidad (Frecuencia: 1 día)<a class="headerlink" href="#analisis-de-estacionalidad-y-periodicidad-frecuencia-1-dia" title="Link to this heading">#</a></h3>
<p>Descomposición de la serie en tendencia, estacionalidad y residuales.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.seasonal</span><span class="w"> </span><span class="kn">import</span> <span class="n">seasonal_decompose</span>

<span class="c1"># Descomposición de la serie temporal para la frecuencia diaria</span>
<span class="n">freq</span> <span class="o">=</span> <span class="s2">&quot;1d&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="n">freq</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;multiplicative&quot;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>  <span class="c1"># Periodo aproximado de 1 año</span>

<span class="c1"># Graficar los componentes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Close&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Serie original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tendencia&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">seasonal</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Estacionalidad&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Residuo&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e3e9aa0210e185306911f14ee7a5391ee5d944006c41157cca9e262be47b11d1.png" src="../_images/e3e9aa0210e185306911f14ee7a5391ee5d944006c41157cca9e262be47b11d1.png" />
</div>
</div>
<p>En el primer panel, y como ya se vio anteriormente, la serie original muestra el precio de Bitcoin con su alta volatilidad, comenzando alrededor de <span class="math notranslate nohighlight">\(10,000 en 2018, experimentando dos ciclos alcistas significativos (2021 y 2024-2025), con el precio máximo superando los \)</span>100,000 a principios de 2025.</p>
<p>El segundo panel muestra la tendencia subyacente, que filtra las fluctuaciones a corto plazo, revelando tres fases principales: un período estable entre 2018-2020, un ciclo alcista y bajista entre 2021-2022, y una nueva fase alcista desde 2023 hasta 2025, sugiriendo ciclos aproximadamente de 4 años.</p>
<p>El tercer panel presenta el componente estacional, que muestra patrones recurrentes dentro de cada año con fluctuaciones entre 0.85 y 1.15, indicando que Bitcoin tiende a tener períodos predecibles de mayor y menor actividad que se repiten anualmente.</p>
<p>Finalmente, el componente residual en el cuarto panel captura las fluctuaciones irregulares no explicadas por la tendencia o estacionalidad, mostrando la naturaleza impredecible del mercado de Bitcoin, con momentos de alta volatilidad inexplicable, especialmente durante 2019-2020 y 2021-2022.</p>
</section>
<section id="deteccion-de-anomalias">
<h3>Detección de Anomalías<a class="headerlink" href="#deteccion-de-anomalias" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Detección de anomalías</span>
<span class="c1"># Usamos el método de desviación estándar para detectar outliers</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>  <span class="c1"># Residuos de la descomposición</span>
<span class="n">mean_residual</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std_residual</span> <span class="o">=</span> <span class="n">residuals</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[(</span><span class="n">residuals</span> <span class="o">&gt;</span> <span class="n">mean_residual</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_residual</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">residuals</span> <span class="o">&lt;</span> <span class="n">mean_residual</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">std_residual</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Residuos&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">outliers</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">outliers</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Outliers&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Detección de anomalías en los residuos, frecuencia: 1 dia&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Residuos&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8f9baf646d12d13bb8a231c133216b24f054314bbbc60c7474148c29f4827a10.png" src="../_images/8f9baf646d12d13bb8a231c133216b24f054314bbbc60c7474148c29f4827a10.png" />
</div>
</div>
<p>En esta gráfica, los residuos de la descomposición de la serie temporal se muestran en azul, y los valores atípicos (outliers) se resaltan en rojo.</p>
<p>La detección de anomalías en los residuos de la serie temporal de Bitcoin con frecuencia diaria revela eventos extremos que han impactado significativamente el mercado. Estos outliers, que se desvían más de 2 desviaciones estándar de la media, están asociados con eventos clave que han influido en el comportamiento del precio de Bitcoin.</p>
<p>Los outliers detectados en los residuos reflejan la naturaleza altamente volátil del mercado de Bitcoin y su sensibilidad a eventos externos como los ya mencionados anteriormente. Estos eventos no solo generan movimientos bruscos en el precio, sino que también tienen un impacto duradero en la confianza del mercado y la adopción de Bitcoin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4.1 Diagramas de caja por periodo (meses)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribución de precios de cierre de Bitcoin por mes&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Mes&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de cierre (USD)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/409057fb9a3f47fba4bafcb9fe78327101fc7e91385e7d3371aeecb766a8ffd6.png" src="../_images/409057fb9a3f47fba4bafcb9fe78327101fc7e91385e7d3371aeecb766a8ffd6.png" />
</div>
</div>
<p>El análisis de la distribución de precios de cierre de Bitcoin revela patrones significativos de volatilidad y estacionalidad a lo largo del año. Los datos muestran una clara tendencia hacia mayor volatilidad y precios extremadamente altos en los meses de invierno (diciembre, enero y febrero), donde se observan valores atípicos superiores a los <span class="math notranslate nohighlight">\(100,000 USD. En contraste, el período de mediados de año (junio a septiembre) presenta rangos más estrechos, sugiriendo fases de relativa estabilidad en el mercado. Las medianas mensuales oscilan principalmente entre \)</span>20,000 y $30,000 USD, pero los rangos intercuartílicos más amplios en marzo y abril indican períodos de mayor incertidumbre y dispersión en los precios.</p>
</section>
<section id="analisis-de-tendencia">
<h3>Análisis de tendencia<a class="headerlink" href="#analisis-de-tendencia" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.holtwinters</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExponentialSmoothing</span>

<span class="c1"># Aplicar suavizamiento exponencial</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close&quot;</span><span class="p">],</span> <span class="n">trend</span><span class="o">=</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">seasonal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">damped</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># Ajustar el nivel de suavizado</span>

<span class="c1"># Graficar el precio original y el suavizado</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Precio de Cierre (15 min)&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">fit</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tendencia (suavizamiento exponencial)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre de Bitcoin con Suavizamiento Exponencial&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Precio de Cierre (USD)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/elianafuentes/miniconda3/envs/ml_venv/lib/python3.9/site-packages/statsmodels/tsa/base/tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
/Users/elianafuentes/miniconda3/envs/ml_venv/lib/python3.9/site-packages/statsmodels/tsa/holtwinters/model.py:918: ConvergenceWarning: Optimization failed to converge. Check mle_retvals.
  warnings.warn(
</pre></div>
</div>
<img alt="../_images/d93367c66842384cc3c8b3896685f1c6b7acc137c516be62acf248896949c01e.png" src="../_images/d93367c66842384cc3c8b3896685f1c6b7acc137c516be62acf248896949c01e.png" />
</div>
</div>
<p>Esta gráfica confirma lo visto anteriormente, el precio de Bitcoin ha mostrado ciclos de mercado claros cada cuatro años, coincidiendo con los halvings. Tras una consolidación entre 2018 y 2020, experimentó un alza significativa en 2021, seguida de una corrección en 2022. A partir de 2023, inició un nuevo ciclo alcista, alcanzando máximos históricos en 2025. Esto confirma la tendencia alcista a largo plazo de Bitcoin, a pesar de su volatilidad.</p>
</section>
<section id="analisis-de-autocorrelacion">
<h3>Análisis de autocorrelación<a class="headerlink" href="#analisis-de-autocorrelacion" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Para la serie original - Frecuencia 15min</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1"># Figura más grande</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="c1"># Ajustamos a 192 lags (que equivale a 2 días para datos de 15min: 24h * 4 observaciones/hora * 2 días)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close&quot;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación (ACF) - Precio de Cierre (Original)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lags (períodos de 15 minutos)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close&quot;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación Parcial (PACF) - Precio de Cierre (Original)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lags (períodos de 15 minutos)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/faabc4fbdc56bb4047539a28c05d0af6f5648d8ebc4e39725454de2be96e8837.png" src="../_images/faabc4fbdc56bb4047539a28c05d0af6f5648d8ebc4e39725454de2be96e8837.png" />
</div>
</div>
<p>El gráfico de Autocorrelación (ACF) del precio de cierre de Bitcoin muestra autocorrelaciones extremadamente altas y persistentes (cercanas a 1) en todos los rezagos analizados, sin mostrar disminución significativa incluso en rezagos distantes. Este patrón es característico de una serie temporal fuertemente no estacionaria, como una caminata aleatoria o una serie con tendencia determinista. Esta persistencia total de la autocorrelación confirma la necesidad de aplicar diferenciación para lograr estacionariedad.</p>
<p>El gráfico de Autocorrelación Parcial (PACF) muestra un pico significativo únicamente en el primer rezago, seguido de valores que caen dentro de las bandas de significancia estadística. Esto sugiere que, controlando por el efecto del valor inmediatamente anterior, los rezagos adicionales no aportan información significativa.</p>
</section>
<section id="analisis-de-estacionaridad">
<h3>Análisis de Estacionaridad<a class="headerlink" href="#analisis-de-estacionaridad" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prueba de Dickey-Fuller aumentada (ADF)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_stationarity</span><span class="p">(</span><span class="n">timeseries</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resultados de la prueba de Dickey-Fuller:&#39;</span><span class="p">)</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">dfoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Estadístico&#39;</span><span class="p">,</span> <span class="s1">&#39;p-valor&#39;</span><span class="p">,</span> <span class="s1">&#39;#Lags&#39;</span><span class="p">,</span> <span class="s1">&#39;Observaciones&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dfoutput</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Valor crítico (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dfoutput</span><span class="p">)</span>

<span class="n">test_stationarity</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resultados de la prueba de Dickey-Fuller:
Estadístico                 0.304424
p-valor                     0.977547
#Lags                      84.000000
Observaciones          248312.000000
Valor crítico (1%)         -3.430376
Valor crítico (5%)         -2.861552
Valor crítico (10%)        -2.566776
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Estos resultados de la prueba de Dickey-Fuller para la serie temporal del precio de Bitcoin indican claramente que la serie no es estacionaria. El p-valor extremadamente alto de 0.977547 confirma que no podemos rechazar la hipótesis nula de que existe una raíz unitaria en la serie.</p>
<p>Esta prueba confirma formalmente lo que sugerían los gráficos de autocorrelación: el precio de Bitcoin presenta una tendencia persistente y no revierte a una media constante a lo largo del tiempo. Para realizar análisis estadísticos adecuados o construir modelos predictivos, sería necesario transformar la serie mediante diferenciación u otros métodos para conseguir estacionariedad. Este resultado es típico en series de precios de activos financieros y coincide con la teoría de que los mercados financieros suelen seguir un comportamiento similar al de un paseo aleatorio.</p>
</section>
</section>
<section id="transformacion-de-datos">
<h2>Transformación de datos<a class="headerlink" href="#transformacion-de-datos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cargar el dataset de 15 minutos</span>
<span class="n">df_15m</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;15m&#39;</span><span class="p">]</span>  
<span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;Close_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verificar la estacionariedad de &#39;Close_diff&#39;</span>
<span class="n">test_stationarity</span><span class="p">(</span><span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;Close_diff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>  
<span class="c1"># Eliminar la columna &#39;Close&#39; ya que &#39;Close_diff&#39; es suficiente</span>
<span class="n">df_15m</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resultados de la prueba de Dickey-Fuller:
Estadístico               -53.495730
p-valor                     0.000000
#Lags                      85.000000
Observaciones          248310.000000
Valor crítico (1%)         -3.430376
Valor crítico (5%)         -2.861552
Valor crítico (10%)        -2.566776
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficar ACF Y PACF de la serie diferenciada</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># ACF completa</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF - Vista completa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># ACF sin lag 0 (para ver mejor el detalle)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF - Detalle (sin lag 0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Ajustar según tus datos</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># PACF completa</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PACF - Vista completa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># PACF sin lag 0 (para ver mejor el detalle)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PACF - Detalle (sin lag 0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Ajustar según tus datos</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e2c4732e66efd0b900d70cc7525f84b657d8d1555cfe198884d07a63522b319e.png" src="../_images/e2c4732e66efd0b900d70cc7525f84b657d8d1555cfe198884d07a63522b319e.png" />
</div>
</div>
<p>Los resultados de la prueba de Dickey-Fuller para la serie diferenciada del precio de Bitcoin muestran un cambio drástico respecto a la serie original. El estadístico de prueba de -53.495730 es significativamente menor que todos los valores críticos (-3.430376 al 1%, -2.861552 al 5% y -2.566776 al 10%), y el p-valor extremadamente bajo de 0.000000 indica que podemos rechazar con gran confianza la hipótesis nula de no estacionariedad. Esto confirma que la serie diferenciada es estacionaria, lo que significa que sus propiedades estadísticas (como la media y la varianza) se mantienen constantes a lo largo del tiempo.</p>
<p>La diferenciación, que calcula los cambios en el precio en intervalos de 15 minutos en lugar de los precios absolutos, ha eliminado la tendencia persistente y ha estabilizado la serie.</p>
<p>Análisis de las gráficas ACF y PACF:</p>
<p>Las gráficas ACF y PACF de la serie diferenciada muestran que no hay autocorrelaciones significativas en ningún rezago (excepto el lag 0), ya que todos los valores están dentro de las bandas de significancia del 95%. Esto sugiere que la serie diferenciada se comporta como un ruido blanco, indicando que el proceso de diferenciación ha eliminado efectivamente cualquier estructura de autocorrelación, tendencia o estacionalidad que pudiera haber existido en la serie original.</p>
</section>
<section id="analisis-de-estacionaridad-variables-predictoras">
<h2>Análisis de estacionaridad variables predictoras<a class="headerlink" href="#analisis-de-estacionaridad-variables-predictoras" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Para las series originales - Frecuencia 15min</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>  <span class="c1"># Figura más grande para acomodar 3 pares de gráficos</span>

<span class="c1"># Open original</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">611</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Open&quot;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación (ACF) - Precio de Apertura (Original)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lags (períodos de 15 minutos)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">612</span><span class="p">)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Open&quot;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación Parcial (PACF) - Precio de Apertura (Original)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lags (períodos de 15 minutos)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># High original</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">613</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;High&quot;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación (ACF) - Precio Máximo (Original)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lags (períodos de 15 minutos)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">614</span><span class="p">)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;High&quot;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación Parcial (PACF) - Precio Máximo (Original)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lags (períodos de 15 minutos)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># Low original</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">615</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Low&quot;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación (ACF) - Precio Mínimo (Original)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lags (períodos de 15 minutos)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">616</span><span class="p">)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Low&quot;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Autocorrelación Parcial (PACF) - Precio Mínimo (Original)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lags (períodos de 15 minutos)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bbf2c88e03648659876a62f9c5085ddfb416a4d74fcdf04d7ec9a19d32f8087c.png" src="../_images/bbf2c88e03648659876a62f9c5085ddfb416a4d74fcdf04d7ec9a19d32f8087c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.stattools</span><span class="w"> </span><span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_stationarity</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Realiza la prueba ADF y muestra los resultados.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        timeseries (pd.Series): La serie de tiempo a evaluar.</span>
<span class="sd">        column_name (str): El nombre de la columna para mostrar en los resultados.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--- Resultados de la prueba ADF para </span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s1"> (15m) ---&#39;</span><span class="p">)</span>
    <span class="n">adf_test</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>  <span class="c1"># Puedes ajustar &#39;autolag&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estadística ADF: </span><span class="si">{</span><span class="n">adf_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p-value: </span><span class="si">{</span><span class="n">adf_test</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Valores Críticos:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">adf_test</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;   </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1"># Verificar la estacionariedad de las features</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Volume&#39;</span><span class="p">]:</span>
    <span class="n">test_stationarity</span><span class="p">(</span><span class="n">df_15m</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Resultados de la prueba ADF para Open (15m) ---
Estadística ADF: 0.2968
p-value: 0.9772
Valores Críticos:
   1%: -3.4304
   5%: -2.8616
   10%: -2.5668
--- Resultados de la prueba ADF para High (15m) ---
Estadística ADF: 0.3387
p-value: 0.9791
Valores Críticos:
   1%: -3.4304
   5%: -2.8616
   10%: -2.5668
--- Resultados de la prueba ADF para Low (15m) ---
Estadística ADF: 0.2704
p-value: 0.9759
Valores Críticos:
   1%: -3.4304
   5%: -2.8616
   10%: -2.5668
--- Resultados de la prueba ADF para Volume (15m) ---
Estadística ADF: -14.9230
p-value: 0.0000
Valores Críticos:
   1%: -3.4304
   5%: -2.8616
   10%: -2.5668
</pre></div>
</div>
</div>
</div>
<p>Los resultados de la prueba de Dickey-Fuller Aumentada (ADF) muestran p-values excesivamente altos para las series ‘Open’, ‘High’ y ‘Low’ (0.9772, 0.9791 y 0.9759, respectivamente), todos muy superiores al umbral de significancia de 0.05. Adicionalmente, las estadísticas ADF (0.2968, 0.3387 y 0.2704) superan todos los valores críticos establecidos. Ambos indicadores nos llevan a no rechazar la hipótesis nula de la prueba, proporcionando evidencia estadística contundente de que no son estacionarias.</p>
<p>Los resultados de la prueba de Dickey-Fuller Aumentada para ‘Volume’ arroja un p-value de 0.0000 (prácticamente cero), muy inferior al nivel de significancia de 0.05. Adicionalmente, la estadística ADF obtenida (-14.9230) es considerablemente menor (más negativa) que todos los valores críticos establecidos. Estos indicadores nos permiten rechazar contundentemente la hipótesis nula de la prueba, proporcionando evidencia estadística sólida de que ‘Volume’ es estacionaria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Diferenciamos para hacer estacionarias las series de tiempo</span>
<span class="c1"># if p-value &gt;= 0.05 para alguna columna:  </span>
<span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;Open_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;High_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;High&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;Low_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_15m</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df_15m</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Eliminar las filas NaN generadas por diff()</span>

<span class="c1"># Volver a verificar la estacionariedad después de la diferenciación</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Después de la diferenciación:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Open_diff&#39;</span><span class="p">,</span> <span class="s1">&#39;High_diff&#39;</span><span class="p">,</span> <span class="s1">&#39;Low_diff&#39;</span><span class="p">]:</span> <span class="c1"># Volume ya es estacionaria</span>
    <span class="n">test_stationarity</span><span class="p">(</span><span class="n">df_15m</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">col</span><span class="p">)</span>

<span class="c1"># Eliminar las columnas originales no diferenciadas</span>
<span class="n">df_15m</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Open&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="s1">&#39;Low&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Después de la diferenciación:
--- Resultados de la prueba ADF para Open_diff (15m) ---
Estadística ADF: -53.4924
p-value: 0.0000
Valores Críticos:
   1%: -3.4304
   5%: -2.8616
   10%: -2.5668
--- Resultados de la prueba ADF para High_diff (15m) ---
Estadística ADF: -57.0730
p-value: 0.0000
Valores Críticos:
   1%: -3.4304
   5%: -2.8616
   10%: -2.5668
--- Resultados de la prueba ADF para Low_diff (15m) ---
Estadística ADF: -53.8170
p-value: 0.0000
Valores Críticos:
   1%: -3.4304
   5%: -2.8616
   10%: -2.5668
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Para la serie Open_diff</span>
<span class="n">fig1</span><span class="p">,</span> <span class="n">axes1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># ACF completa</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Open_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF Open_diff - Vista completa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># ACF sin lag 0 (para ver mejor el detalle)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Open_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF Open_diff - Detalle (sin lag 0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Ajustar según tus datos</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># PACF completa</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Open_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PACF Open_diff - Vista completa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># PACF sin lag 0 (para ver mejor el detalle)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Open_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PACF Open_diff - Detalle (sin lag 0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Ajustar según tus datos</span>
<span class="n">axes1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Para la serie High_diff</span>
<span class="n">fig2</span><span class="p">,</span> <span class="n">axes2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># ACF completa</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;High_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF High_diff - Vista completa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># ACF sin lag 0 (para ver mejor el detalle)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;High_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF High_diff - Detalle (sin lag 0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Ajustar según tus datos</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># PACF completa</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;High_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PACF High_diff - Vista completa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># PACF sin lag 0 (para ver mejor el detalle)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;High_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PACF High_diff - Detalle (sin lag 0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Ajustar según tus datos</span>
<span class="n">axes2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Para la serie Low_diff</span>
<span class="n">fig3</span><span class="p">,</span> <span class="n">axes3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># ACF completa</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Low_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF Low_diff - Vista completa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># ACF sin lag 0 (para ver mejor el detalle)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Low_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
         <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF Low_diff - Detalle (sin lag 0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Ajustar según tus datos</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># PACF completa</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Low_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PACF Low_diff - Vista completa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># PACF sin lag 0 (para ver mejor el detalle)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">][</span><span class="s2">&quot;Low_diff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
          <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PACF Low_diff - Detalle (sin lag 0)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Ajustar según tus datos</span>
<span class="n">axes3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2d2d10ba724161627ba5117d53e7f6f6ceb410a71d3be5239cacb183b3c00801.png" src="../_images/2d2d10ba724161627ba5117d53e7f6f6ceb410a71d3be5239cacb183b3c00801.png" />
<img alt="../_images/3a4f3014db22992b420f0f0175130941f9f2a7557b3b2c5a90b2372add948edd.png" src="../_images/3a4f3014db22992b420f0f0175130941f9f2a7557b3b2c5a90b2372add948edd.png" />
<img alt="../_images/3b2c895e9ef2117dddb9ac2b975f922f18f2006929e1f933485ca11961b44a32.png" src="../_images/3b2c895e9ef2117dddb9ac2b975f922f18f2006929e1f933485ca11961b44a32.png" />
</div>
</div>
<p>Después de aplicar la primera diferenciación a las series de tiempo de ‘Open’, ‘High’ y ‘Low’, los resultados de la prueba ADF muestran una fuerte evidencia de estacionariedad. Los p-valores para ‘Open_diff’, ‘High_diff’ y ‘Low_diff’ son todos 0.0000, lo cual es significativamente menor que cualquier nivel de significancia común (por ejemplo, 0.05). Esto nos permite rechazar la hipótesis nula de la prueba ADF y concluir que las series diferenciadas son estacionarias. Además, las estadísticas ADF (-53.4912, -57.0698 y -53.8156) son mucho menores que los valores críticos, lo que también respalda la afirmación de estacionariedad.</p>
<p>En las <strong>gráficas ACF y PACF</strong> de vista completa, observamos:</p>
<ul class="simple">
<li><p>Un pico inicial en lag 0 (autocorrelación perfecta de 1.0)</p></li>
<li><p>Prácticamente ninguna correlación significativa en los demás lags</p></li>
<li><p>Las autocorrelaciones están muy cercanas a cero para todos los lags excepto el cero</p></li>
</ul>
<p>En las vistas detalladas:</p>
<ul class="simple">
<li><p>Hay algunas correlaciones que superan ligeramente las bandas de significancia, pero son mínimas y esporádicas</p></li>
<li><p>La magnitud de estas correlaciones es muy pequeña (en el rango de ±0.025)</p></li>
<li><p>No se observa un patrón sistemático o persistente de autocorrelaciones</p></li>
</ul>
<p>En resumen, la primera diferenciación ha sido efectiva para eliminar la no estacionariedad.</p>
</section>
<section id="conclusiones-finales-eda">
<h2>Conclusiones finales EDA<a class="headerlink" href="#conclusiones-finales-eda" title="Link to this heading">#</a></h2>
<p>El análisis exploratorio de datos (EDA) del precio de cierre de Bitcoin ha revelado una serie de patrones y características clave que son fundamentales para entender su comportamiento:</p>
<p>Tendencia General: Bitcoin ha mostrado una tendencia alcista a largo plazo, con ciclos de mercado claros que coinciden con eventos importantes como halvings y crisis en el ecosistema cripto.</p>
<p>Volatilidad: El precio de Bitcoin es altamente volátil, con fluctuaciones significativas en períodos cortos. Esta volatilidad está influenciada por eventos externos, como noticias económicas y cambios regulatorios.</p>
<p>Estacionalidad: Se han identificado patrones recurrentes en los datos, especialmente en ciclos anuales. Estos patrones sugieren que Bitcoin tiende a tener períodos predecibles de mayor y menor actividad.</p>
<p>Anomalías: Los valores atípicos detectados en los residuos están asociados con eventos extremos, como el colapso de FTX en 2022. Estos eventos tienen un impacto significativo en el precio y la confianza del mercado.</p>
<p>Estacionariedad: La serie original no es estacionaria, pero la diferenciación ha permitido lograr estacionariedad, lo que es crucial para la aplicación de modelos predictivos.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="implementacion-de-modelos">
<h1>Implementación de Modelos<a class="headerlink" href="#implementacion-de-modelos" title="Link to this heading">#</a></h1>
<section id="prediccion-del-precio-de-cierre-del-bitcoin-frecuencia-15-min">
<h2>Predicción del Precio de Cierre del Bitcoin (Frecuencia: 15 min)<a class="headerlink" href="#prediccion-del-precio-de-cierre-del-bitcoin-frecuencia-15-min" title="Link to this heading">#</a></h2>
<p>Se prepara el dataset <code class="docutils literal notranslate"><span class="pre">df_15m</span></code> usando una estrategia de ventanas móviles (rolling window) para predecir <code class="docutils literal notranslate"><span class="pre">close_diff</span></code> a partir de las variables <code class="docutils literal notranslate"><span class="pre">return</span></code>, <code class="docutils literal notranslate"><span class="pre">volumen</span></code>, <code class="docutils literal notranslate"><span class="pre">open_diff</span></code>, <code class="docutils literal notranslate"><span class="pre">high_diff</span></code>, <code class="docutils literal notranslate"><span class="pre">low_diff</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_15m</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Volume</th>
      <th>Close_diff</th>
      <th>Open_diff</th>
      <th>High_diff</th>
      <th>Low_diff</th>
    </tr>
    <tr>
      <th>Open time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2018-01-01 00:15:00</th>
      <td>98.136430</td>
      <td>-35.03</td>
      <td>-181.90</td>
      <td>-164.78</td>
      <td>1.99</td>
    </tr>
    <tr>
      <th>2018-01-01 00:30:00</th>
      <td>79.904037</td>
      <td>-50.71</td>
      <td>-33.75</td>
      <td>-5.50</td>
      <td>48.00</td>
    </tr>
    <tr>
      <th>2018-01-01 00:45:00</th>
      <td>141.699719</td>
      <td>58.60</td>
      <td>-5.35</td>
      <td>145.50</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2018-01-01 01:00:00</th>
      <td>72.537533</td>
      <td>-83.38</td>
      <td>34.34</td>
      <td>-119.13</td>
      <td>-47.72</td>
    </tr>
    <tr>
      <th>2018-01-01 01:15:00</th>
      <td>87.861758</td>
      <td>114.37</td>
      <td>-59.00</td>
      <td>24.15</td>
      <td>43.35</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="aplicacion-de-modelos-benchmark">
<h2>Aplicacion de modelos BenchMark<a class="headerlink" href="#aplicacion-de-modelos-benchmark" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s2">&quot;15m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                         Volume  Close_diff  Open_diff  High_diff  Low_diff
Open time                                                                  
2018-01-01 00:15:00   98.136430      -35.03    -181.90    -164.78      1.99
2018-01-01 00:30:00   79.904037      -50.71     -33.75      -5.50     48.00
2018-01-01 00:45:00  141.699719       58.60      -5.35     145.50      0.00
2018-01-01 01:00:00   72.537533      -83.38      34.34    -119.13    -47.72
2018-01-01 01:15:00   87.861758      114.37     -59.00      24.15     43.35
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="preparacion-de-los-datos">
<h1>Preparacion de los datos<a class="headerlink" href="#preparacion-de-los-datos" title="Link to this heading">#</a></h1>
<p>La preparación de datos se realizó en dos etapas clave: primero se enriqueció el DataFrame original con variables temporales relevantes, y luego se generaron los pliegues para validación cruzada con enfoque rolling window.</p>
<section id="enriquecimiento-del-dataframe-transformar-features-temporales">
<h2>1. Enriquecimiento del DataFrame: <code class="docutils literal notranslate"><span class="pre">transformar_features_temporales()</span></code><a class="headerlink" href="#enriquecimiento-del-dataframe-transformar-features-temporales" title="Link to this heading">#</a></h2>
<p>Se utilizó la función <code class="docutils literal notranslate"><span class="pre">transformar_features_temporales()</span></code> para agregar nuevas características basadas en la dinámica pasada de la serie objetivo <code class="docutils literal notranslate"><span class="pre">Close_diff</span></code>. Esta transformación permite que los modelos capten información temporal de corto plazo.</p>
<p>Las variables agregadas incluyen:</p>
<ul class="simple">
<li><p><strong>Lags del target</strong>: valores rezagados de <code class="docutils literal notranslate"><span class="pre">Close_diff</span></code>, como <code class="docutils literal notranslate"><span class="pre">Close_diff_lag1</span></code>, <code class="docutils literal notranslate"><span class="pre">lag2</span></code>, etc.</p></li>
<li><p><strong>Media móvil simple (SMA)</strong>: promedio deslizante de los últimos valores.</p></li>
<li><p><strong>Desviación estándar móvil (STD)</strong>: medida de la volatilidad local.</p></li>
<li><p><strong>Media móvil exponencial (EMA)</strong>: pondera más los datos recientes, útil para seguir tendencias.</p></li>
</ul>
<p>Esta etapa genera un nuevo DataFrame llamado <code class="docutils literal notranslate"><span class="pre">df_transformado</span></code>.</p>
<p>Posteriormente, se aplicó una validación cruzada tipo <strong>rolling window</strong>, adecuada para series temporales. Se utilizó la función <code class="docutils literal notranslate"><span class="pre">create_rolling_folds_total()</span></code> para dividir el DataFrame transformado en múltiples pliegues consecutivos de entrenamiento y prueba.</p>
<p><strong>Parámetros utilizados:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">window_size</span> <span class="pre">=</span> <span class="pre">672</span></code>: número de observaciones usadas para entrenamiento (equivale a 7 días de datos en ventanas de 15 minutos).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">horizon</span> <span class="pre">=</span> <span class="pre">4</span></code>: tamaño del conjunto de prueba (equivale a 1 hora de predicción futura).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jump</span> <span class="pre">=</span> <span class="pre">4</span></code>: tamaño del desplazamiento entre ventanas (1 hora).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">transformar_features_temporales</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;Close_diff&#39;</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">ma_windows</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">std_windows</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ema_windows</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Agrega lags y estadísticas móviles al dataframe para enriquecer el modelo multivariado.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    -----------</span>
<span class="sd">    df : DataFrame</span>
<span class="sd">        Dataset con el target y todas las features originales.</span>
<span class="sd">    target_col : str</span>
<span class="sd">        Columna objetivo (por defecto: &#39;Close_diff&#39;).</span>
<span class="sd">    lags : list of int</span>
<span class="sd">        Lags que se agregarán como features.</span>
<span class="sd">    ma_windows : list of int</span>
<span class="sd">        Ventanas para medias móviles simples.</span>
<span class="sd">    std_windows : list of int</span>
<span class="sd">        Ventanas para desviaciones estándar móviles.</span>
<span class="sd">    ema_windows : list of int</span>
<span class="sd">        Ventanas para medias móviles exponenciales.</span>

<span class="sd">    Retorna:</span>
<span class="sd">    --------</span>
<span class="sd">    df_transformado : DataFrame listo para usar en modelado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Agregar lags</span>
    <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_lag</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>

    <span class="c1"># Medias móviles (SMA)</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">ma_windows</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_ma</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Desviaciones estándar móviles</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">std_windows</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_std</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="c1"># Medias móviles exponenciales (EMA)</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">ema_windows</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_ema</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_rolling_folds_total</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;Close_diff&#39;</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">672</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">jump</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Genera folds tipo rolling window multivariado usando toda la base (sin partición 80/20).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>
    <span class="n">folds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">end_train</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">window_size</span>
        <span class="n">end_test</span> <span class="o">=</span> <span class="n">end_train</span> <span class="o">+</span> <span class="n">horizon</span>
        <span class="k">if</span> <span class="n">end_test</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="k">break</span>

        <span class="n">df_train</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end_train</span><span class="p">]</span>
        <span class="n">df_test</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">end_train</span><span class="p">:</span><span class="n">end_test</span><span class="p">]</span>

        <span class="n">X_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>
        <span class="n">y_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target_col</span><span class="p">])</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>

        <span class="n">folds</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;X_train&#39;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">,</span>
            <span class="s1">&#39;y_train&#39;</span><span class="p">:</span> <span class="n">y_train</span><span class="p">,</span>
            <span class="s1">&#39;X_test&#39;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">,</span>
            <span class="s1">&#39;y_test&#39;</span><span class="p">:</span> <span class="n">y_test</span>
        <span class="p">})</span>

        <span class="n">start</span> <span class="o">+=</span> <span class="n">jump</span>

    <span class="k">return</span> <span class="n">folds</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mostrar_folds_temporales_limite</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">folds</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">[:</span><span class="n">n_folds</span><span class="p">]):</span>
        <span class="n">train_idx</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="n">test_idx</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">train_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">train_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">test_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">test_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Close_diff&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Serie&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Visualización de </span><span class="si">{</span><span class="n">n_folds</span><span class="si">}</span><span class="s1"> Folds Temporales (Rolling Window Completo)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Close_diff&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Paso 1: transforma el DataFrame original</span>
<span class="n">df_transformado</span> <span class="o">=</span> <span class="n">transformar_features_temporales</span><span class="p">(</span><span class="n">df_15m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Paso 2: crea los folds sobre el nuevo DataFrame enriquecido</span>
<span class="n">folds</span> <span class="o">=</span> <span class="n">create_rolling_folds_total</span><span class="p">(</span><span class="n">df_transformado</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">672</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">jump</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mostrar_folds_temporales_limite</span><span class="p">(</span><span class="n">df_15m</span><span class="p">,</span> <span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fa6680d438614ecf277db33289a6c0ae568522c048a5663c7f56e261c19cd6f8.png" src="../_images/fa6680d438614ecf277db33289a6c0ae568522c048a5663c7f56e261c19cd6f8.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="k-nearest-neighbors-knn">
<h1>K-Nearest Neighbors (KNN)<a class="headerlink" href="#k-nearest-neighbors-knn" title="Link to this heading">#</a></h1>
<section id="definicion-general">
<h2>Definición General<a class="headerlink" href="#definicion-general" title="Link to this heading">#</a></h2>
<p>K-Nearest Neighbors (KNN) es un algoritmo de aprendizaje supervisado utilizado tanto para tareas de clasificación como de regresión. Es un modelo basado en instancias, lo que significa que no aprende una función explícita durante la fase de entrenamiento, sino que memoriza el conjunto de entrenamiento completo y toma decisiones en función de la similitud entre observaciones.</p>
<p>En la regresión con KNN, la predicción para un nuevo punto se calcula como el <strong>promedio de los valores de los <span class="math notranslate nohighlight">\(k\)</span> vecinos más cercanos</strong> en el conjunto de entrenamiento.</p>
</section>
<section id="caracteristicas-clave">
<h2>Características Clave<a class="headerlink" href="#caracteristicas-clave" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>No paramétrico: no asume ninguna forma funcional de la distribución de los datos.</p></li>
<li><p>Sensible a la escala de las variables (se recomienda normalizar o estandarizar).</p></li>
<li><p>No requiere entrenamiento complejo.</p></li>
<li><p>Muy interpretativo, pero costoso en tiempo de predicción con grandes volúmenes de datos.</p></li>
</ul>
</section>
<section id="aplicacion-matematica">
<h2>Aplicación Matemática<a class="headerlink" href="#aplicacion-matematica" title="Link to this heading">#</a></h2>
<p>Sea <span class="math notranslate nohighlight">\(x\)</span> un nuevo vector de características, y <span class="math notranslate nohighlight">\(N_k(x)\)</span> el conjunto de sus <span class="math notranslate nohighlight">\(k\)</span> vecinos más cercanos en el espacio métrico (usualmente distancia Euclidiana). Entonces, la predicción <span class="math notranslate nohighlight">\(\hat{y}(x)\)</span> se calcula como:</p>
<div class="math notranslate nohighlight">
\[
\hat{y}(x) = \frac{1}{k} \sum_{i \in N_k(x)} y_i
\]</div>
<p>En tareas de clasificación, se toma la clase más frecuente entre los vecinos.</p>
</section>
<section id="metricas-de-distancia-comunes">
<h2>Métricas de Distancia Comunes<a class="headerlink" href="#metricas-de-distancia-comunes" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Distancia Euclidiana</strong>:<br />
$<span class="math notranslate nohighlight">\(
d(x, x') = \sqrt{\sum_{j=1}^n (x_j - x'_j)^2}
\)</span>$</p></li>
<li><p><strong>Distancia de Manhattan</strong>:<br />
$<span class="math notranslate nohighlight">\(
d(x, x') = \sum_{j=1}^n |x_j - x'_j|
\)</span>$</p></li>
</ul>
</section>
<section id="optimizacion-para-knn">
<h2>Optimización para KNN<a class="headerlink" href="#optimizacion-para-knn" title="Link to this heading">#</a></h2>
<p>KNN puede volverse computacionalmente costoso si el número de observaciones o dimensiones es grande. Para acelerar las búsquedas de vecinos, se emplean estructuras de índice:</p>
<ul class="simple">
<li><p><strong>KD-Tree</strong>: particiona el espacio en regiones binarias; eficiente en dimensiones bajas.</p></li>
<li><p><strong>Ball Tree</strong>: usa hiperesferas; mejor en espacios de alta dimensión.</p></li>
<li><p><strong>FAISS</strong> (Facebook AI Similarity Search): librería eficiente para búsquedas rápidas en grandes volúmenes de datos, especialmente con embeddings o vectores densos.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">evaluar_knn_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evalúa KNN Regressor optimizado sobre folds rolling.</span>
<span class="sd">    Devuelve métricas por fold y serie real vs. predicho.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">jarque_bera</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">smape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="n">diff</span><span class="p">[</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">root_mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Evaluando modelo KNN Regressor...&quot;</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">resultados</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_true_full</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_pred_full</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_train&#39;</span><span class="p">]</span>
        <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_test&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span>

        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
            <span class="p">]),</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="p">])</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">])</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span>

        <span class="n">y_true_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">y_pred_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

        <span class="n">resultados</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;fold&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;RMSE&quot;</span><span class="p">:</span> <span class="n">root_mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;MAE&quot;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;SMAPE&quot;</span><span class="p">:</span> <span class="n">smape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;Ljung_p&quot;</span><span class="p">:</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;lb_pvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;Jarque_p&quot;</span><span class="p">:</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">df_resultados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">)</span>

    <span class="n">y_true_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_true_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_pred_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="n">serie_completa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;Real&quot;</span><span class="p">:</span> <span class="n">y_true_total</span><span class="p">,</span>
        <span class="s2">&quot;Predicho&quot;</span><span class="p">:</span> <span class="n">y_pred_total</span>
    <span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Tiempo total: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inicio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Promedio de métricas:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_resultados</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df_resultados</span><span class="p">,</span> <span class="n">serie_completa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_knn</span><span class="p">,</span> <span class="n">serie_knn</span> <span class="o">=</span> <span class="n">evaluar_knn_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Evaluando modelo KNN Regressor...

 Tiempo total: 1138.96 segundos

 Promedio de métricas:
fold        30965.0000
RMSE           36.2315
MAE            30.6235
SMAPE          80.6742
R2              0.4689
Ljung_p            NaN
Jarque_p        0.7857
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_knn</span><span class="p">[</span><span class="s2">&quot;Real&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_knn</span><span class="p">[</span><span class="s2">&quot;Predicho&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicho&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;KNN - Real vs Predicho (Serie Completa)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0641b731b963c9f746f261e01ef1157ba6eb5a51cbeba6be94b10a3638f0587f.png" src="../_images/0641b731b963c9f746f261e01ef1157ba6eb5a51cbeba6be94b10a3638f0587f.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="ridge-regression">
<h1>Ridge Regression<a class="headerlink" href="#ridge-regression" title="Link to this heading">#</a></h1>
<section id="definicion">
<h2>Definición<a class="headerlink" href="#definicion" title="Link to this heading">#</a></h2>
<p>La regresión Ridge es una extensión de la regresión lineal que añade una penalización L2 a la magnitud de los coeficientes del modelo para evitar el sobreajuste y mejorar la generalización.</p>
<p>El modelo de regresión lineal se define como:</p>
<div class="math notranslate nohighlight">
\[
\hat{y} = X \boldsymbol{\beta}
\]</div>
<p>donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( \hat{y} \in \mathbb{R}^n \)</span> son las predicciones,</p></li>
<li><p><span class="math notranslate nohighlight">\( X \in \mathbb{R}^{n \times p} \)</span> es la matriz de características,</p></li>
<li><p><span class="math notranslate nohighlight">\( \boldsymbol{\beta} \in \mathbb{R}^p \)</span> es el vector de coeficientes.</p></li>
</ul>
<p>La regresión Ridge minimiza la siguiente función de pérdida:</p>
<div class="math notranslate nohighlight">
\[
J(\boldsymbol{\beta}) = \| y - X\boldsymbol{\beta} \|_2^2 + \lambda \| \boldsymbol{\beta} \|_2^2
\]</div>
<p>donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( \| y - X\boldsymbol{\beta} \|_2^2 \)</span> es el error cuadrático medio (MSE),</p></li>
<li><p><span class="math notranslate nohighlight">\( \| \boldsymbol{\beta} \|_2^2 = \sum_{j=1}^p \beta_j^2 \)</span> es la penalización L2 sobre los coeficientes,</p></li>
<li><p><span class="math notranslate nohighlight">\( \lambda \geq 0 \)</span> es el parámetro de regularización que controla la fuerza de la penalización.</p></li>
</ul>
</section>
<section id="intuicion">
<h2>Intuición<a class="headerlink" href="#intuicion" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Cuando <span class="math notranslate nohighlight">\( \lambda = 0 \)</span>, Ridge se reduce a la regresión lineal estándar.</p></li>
<li><p>Cuando <span class="math notranslate nohighlight">\( \lambda \)</span> es muy grande, los coeficientes <span class="math notranslate nohighlight">\( \beta_j \)</span> se acercan a cero, lo que reduce la complejidad del modelo y ayuda a evitar el sobreajuste.</p></li>
</ul>
</section>
<section id="caracteristicas">
<h2>Características<a class="headerlink" href="#caracteristicas" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Penaliza la complejidad del modelo pero <strong>no fuerza coeficientes a cero</strong> (como Lasso).</p></li>
<li><p>Es útil cuando hay <strong>multicolinealidad</strong> entre las variables.</p></li>
<li><p>Siempre tiene una solución cerrada (estable y única).</p></li>
</ul>
</section>
<section id="solucion-cerrada">
<h2>Solución cerrada<a class="headerlink" href="#solucion-cerrada" title="Link to this heading">#</a></h2>
<p>Ridge tiene una solución analítica directa:</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\beta}_{ridge} = (X^TX + \lambda I)^{-1}X^Ty
\]</div>
<p>donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( I \)</span> es la matriz identidad de dimensión <span class="math notranslate nohighlight">\( p \times p \)</span>.</p></li>
</ul>
</section>
<section id="aplicacion">
<h2>Aplicación<a class="headerlink" href="#aplicacion" title="Link to this heading">#</a></h2>
<p>Ridge es ideal cuando:</p>
<ul class="simple">
<li><p>Hay muchas variables correlacionadas.</p></li>
<li><p>Queremos mantener todas las variables pero con regularización suave.</p></li>
<li><p>Necesitamos modelos estables en problemas mal condicionados.</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="lasso-regression-regresion-l1">
<h1>Lasso Regression (Regresión L1)<a class="headerlink" href="#lasso-regression-regresion-l1" title="Link to this heading">#</a></h1>
<section id="id1">
<h2>Definición<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>La regresión Lasso (Least Absolute Shrinkage and Selection Operator) es una variante de la regresión lineal que añade una penalización <strong>L1</strong> sobre los coeficientes. Esta penalización no solo reduce la magnitud de los coeficientes, sino que puede forzarlos a <strong>cero</strong>, realizando así selección de variables de forma automática.</p>
<p>El modelo de regresión lineal clásico se expresa como:</p>
<div class="math notranslate nohighlight">
\[
\hat{y} = X \boldsymbol{\beta}
\]</div>
<p>El objetivo de Lasso es minimizar la siguiente función de pérdida regularizada:</p>
<div class="math notranslate nohighlight">
\[
J(\boldsymbol{\beta}) = \| y - X\boldsymbol{\beta} \|_2^2 + \lambda \| \boldsymbol{\beta} \|_1
\]</div>
<p>donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( \| y - X\boldsymbol{\beta} \|_2^2 \)</span> es el error cuadrático medio (MSE),</p></li>
<li><p><span class="math notranslate nohighlight">\( \| \boldsymbol{\beta} \|_1 = \sum_{j=1}^{p} |\beta_j| \)</span> es la penalización L1,</p></li>
<li><p><span class="math notranslate nohighlight">\( \lambda \geq 0 \)</span> controla la fuerza de la regularización.</p></li>
</ul>
</section>
<section id="id2">
<h2>Intuición<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Cuando <span class="math notranslate nohighlight">\( \lambda = 0 \)</span>, el modelo se comporta como una regresión lineal estándar.</p></li>
<li><p>Al aumentar <span class="math notranslate nohighlight">\( \lambda \)</span>, los coeficientes se encogen y algunos se vuelven exactamente cero.</p></li>
<li><p>Esto convierte a Lasso en una técnica útil para <strong>selección automática de variables</strong> y para <strong>modelos interpretables</strong>.</p></li>
</ul>
</section>
<section id="id3">
<h2>Características clave<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Ideal cuando hay muchas variables irrelevantes o correlacionadas.</p></li>
<li><p>Promueve <strong>sparsity</strong>: mantiene solo las variables más informativas.</p></li>
<li><p>A diferencia de Ridge, puede eliminar variables por completo.</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="optimizacion-matematica-con-solver-saga-para-ridge-y-lasso">
<h1>Optimización matemática con solver ‘saga’ para Ridge y Lasso<a class="headerlink" href="#optimizacion-matematica-con-solver-saga-para-ridge-y-lasso" title="Link to this heading">#</a></h1>
<section id="que-es-saga">
<h2>¿Qué es ‘saga’?<a class="headerlink" href="#que-es-saga" title="Link to this heading">#</a></h2>
<p>El solver <code class="docutils literal notranslate"><span class="pre">'saga'</span></code> es un <strong>algoritmo de optimización estocástico</strong> basado en descenso de gradiente, diseñado para trabajar eficientemente con:</p>
<ul class="simple">
<li><p>Regularización <strong>L1 (Lasso)</strong>, <strong>L2 (Ridge)</strong> y <strong>ElasticNet</strong>.</p></li>
<li><p>Datasets <strong>grandes y dispersos (sparse)</strong>.</p></li>
<li><p><strong>Convergencia más rápida</strong> y precisa que otros métodos como <code class="docutils literal notranslate"><span class="pre">'liblinear'</span></code>, <code class="docutils literal notranslate"><span class="pre">'sag'</span></code> o <code class="docutils literal notranslate"><span class="pre">'lsqr'</span></code>.</p></li>
</ul>
</section>
<section id="formulacion-general-del-problema-optimizado">
<h2>Formulación general del problema optimizado<a class="headerlink" href="#formulacion-general-del-problema-optimizado" title="Link to this heading">#</a></h2>
<p>Para un modelo lineal con regularización general, el problema de optimización se puede expresar como:</p>
<div class="math notranslate nohighlight">
\[
\min_{\boldsymbol{\beta}} \left\{ \frac{1}{n} \sum_{i=1}^{n} \left( y_i - X_i^\top \boldsymbol{\beta} \right)^2 + \lambda R(\boldsymbol{\beta}) \right\}
\]</div>
<p>Donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(X_i \in \mathbb{R}^p\)</span> es la fila de entrada para el ejemplo <span class="math notranslate nohighlight">\(i\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(y_i\)</span> es el valor objetivo,</p></li>
<li><p><span class="math notranslate nohighlight">\(\boldsymbol{\beta} \in \mathbb{R}^p\)</span> son los coeficientes del modelo,</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda\)</span> es el hiperparámetro de regularización,</p></li>
<li><p><span class="math notranslate nohighlight">\(R(\boldsymbol{\beta})\)</span> es la penalización, que depende del tipo de modelo:</p></li>
</ul>
<section id="ridge-penalizacion-l2">
<h3>Ridge (penalización L2):<a class="headerlink" href="#ridge-penalizacion-l2" title="Link to this heading">#</a></h3>
<div class="math notranslate nohighlight">
\[
R(\boldsymbol{\beta}) = \|\boldsymbol{\beta}\|_2^2 = \sum_{j=1}^p \beta_j^2
\]</div>
</section>
<section id="lasso-penalizacion-l1">
<h3>Lasso (penalización L1):<a class="headerlink" href="#lasso-penalizacion-l1" title="Link to this heading">#</a></h3>
<div class="math notranslate nohighlight">
\[
R(\boldsymbol{\beta}) = \|\boldsymbol{\beta}\|_1 = \sum_{j=1}^p |\beta_j|
\]</div>
</section>
</section>
<section id="que-optimiza-saga">
<h2>¿Qué optimiza SAGA?<a class="headerlink" href="#que-optimiza-saga" title="Link to this heading">#</a></h2>
<p>SAGA mejora el algoritmo <strong>Stochastic Average Gradient</strong> aplicando una corrección de variancia que permite:</p>
<ul class="simple">
<li><p>Estimación estable de gradientes por cada iteración.</p></li>
<li><p>Actualización eficiente de coeficientes.</p></li>
<li><p>Compatibilidad con penalizaciones no diferenciables como L1.</p></li>
</ul>
<p>En cada paso de entrenamiento, SAGA actualiza:</p>
<div class="math notranslate nohighlight">
\[
\boldsymbol{\beta}^{(t+1)} = \boldsymbol{\beta}^{(t)} - \eta_t \cdot \left[ \nabla \ell_i(\boldsymbol{\beta}^{(t)}) - \nabla \ell_i(\phi_i) + \frac{1}{n} \sum_{j=1}^{n} \nabla \ell_j(\phi_j) \right]
\]</div>
<p>donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\ell_i\)</span> es la pérdida sobre el ejemplo <span class="math notranslate nohighlight">\(i\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\phi_i\)</span> es el último punto donde se evaluó el gradiente en <span class="math notranslate nohighlight">\(i\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\eta_t\)</span> es la tasa de aprendizaje.</p></li>
</ul>
</section>
<section id="ventajas-del-solver-saga">
<h2>Ventajas del solver ‘saga’:<a class="headerlink" href="#ventajas-del-solver-saga" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Convergencia rápida incluso con regularización L1 (donde otros solvers fallan).</p></li>
<li><p>Soporte nativo para regresión y clasificación con penalizaciones mixtas.</p></li>
<li><p>Escalable a datasets grandes con millones de filas.</p></li>
</ul>
<p>Por eso, <code class="docutils literal notranslate"><span class="pre">'saga'</span></code> es el <strong>solver recomendado</strong> para entrenar modelos Ridge y Lasso de alto rendimiento en contextos de series temporales y datasets financieros grandes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">evaluar_ridge_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evalúa Ridge Regression sobre folds rolling con serie completa reconstruida.</span>
<span class="sd">    Retorna DataFrame de métricas y serie real vs. predicho.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ridge</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">jarque_bera</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">smape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="n">diff</span><span class="p">[</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">root_mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Evaluando Ridge Regression (optimizado)...&quot;</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">resultados</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_true_full</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_pred_full</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_train&#39;</span><span class="p">]</span>
        <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_test&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span>

        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
            <span class="p">]),</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="p">])</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;saga&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
        <span class="p">])</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span>

        <span class="c1"># Guardar serie completa</span>
        <span class="n">y_true_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">y_pred_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

        <span class="n">resultados</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;fold&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;RMSE&quot;</span><span class="p">:</span> <span class="n">root_mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;MAE&quot;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;SMAPE&quot;</span><span class="p">:</span> <span class="n">smape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;Ljung_p&quot;</span><span class="p">:</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;lb_pvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;Jarque_p&quot;</span><span class="p">:</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">df_resultados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">)</span>

    <span class="n">y_true_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_true_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_pred_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="n">serie_completa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;Real&quot;</span><span class="p">:</span> <span class="n">y_true_total</span><span class="p">,</span>
        <span class="s2">&quot;Predicho&quot;</span><span class="p">:</span> <span class="n">y_pred_total</span>
    <span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Tiempo total: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inicio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Promedio de métricas:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_resultados</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df_resultados</span><span class="p">,</span> <span class="n">serie_completa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_ridge</span><span class="p">,</span> <span class="n">serie_ridge</span> <span class="o">=</span> <span class="n">evaluar_ridge_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluando Ridge Regression (optimizado)...

 Tiempo total: 6020.94 segundos

 Promedio de métricas:
fold        30965.0000
RMSE            2.5695
MAE             2.1925
SMAPE          11.7217
R2              0.9944
Ljung_p            NaN
Jarque_p        0.7873
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ridge</span><span class="p">[</span><span class="s2">&quot;Real&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ridge</span><span class="p">[</span><span class="s2">&quot;Predicho&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicho&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Ridge Regression - Real vs Predicho (Serie Completa)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7e66a03b9727cad21042b34c6be8d9040d9b577072131020c34252770de15f2f.png" src="../_images/7e66a03b9727cad21042b34c6be8d9040d9b577072131020c34252770de15f2f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">evaluar_lasso_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evalúa Lasso Regression (L1) sobre folds rolling.</span>
<span class="sd">    Devuelve métricas por fold y serie real vs. predicho.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lasso</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">jarque_bera</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">smape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="n">diff</span><span class="p">[</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">root_mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Evaluando modelo Lasso Regression (L1)...&quot;</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">resultados</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_true_full</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_pred_full</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_train&#39;</span><span class="p">]</span>
        <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_test&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span>

        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
            <span class="p">]),</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="p">])</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>  <span class="c1"># ✅ corregido</span>
        <span class="p">])</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span>

        <span class="n">y_true_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">y_pred_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

        <span class="n">resultados</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;fold&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;RMSE&quot;</span><span class="p">:</span> <span class="n">root_mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;MAE&quot;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;SMAPE&quot;</span><span class="p">:</span> <span class="n">smape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;Ljung_p&quot;</span><span class="p">:</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;lb_pvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;Jarque_p&quot;</span><span class="p">:</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">df_resultados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">)</span>

    <span class="n">y_true_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_true_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_pred_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="n">serie_completa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;Real&quot;</span><span class="p">:</span> <span class="n">y_true_total</span><span class="p">,</span>
        <span class="s2">&quot;Predicho&quot;</span><span class="p">:</span> <span class="n">y_pred_total</span>
    <span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Tiempo total: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inicio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Promedio de métricas:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_resultados</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df_resultados</span><span class="p">,</span> <span class="n">serie_completa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_lasso</span><span class="p">,</span> <span class="n">serie_lasso</span> <span class="o">=</span> <span class="n">evaluar_lasso_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Evaluando modelo Lasso Regression (L1)...

 Tiempo total: 1111.03 segundos

 Promedio de métricas:
fold        30965.0000
RMSE            2.6883
MAE             2.2930
SMAPE          13.7189
R2              0.9914
Ljung_p            NaN
Jarque_p        0.7873
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_lasso</span><span class="p">[</span><span class="s2">&quot;Real&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_lasso</span><span class="p">[</span><span class="s2">&quot;Predicho&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicho&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Lasso Regression - Real vs Predicho (Serie Completa)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0d090a8cf2734925c7cc8507b22c78aac2d09575496fe7ecad01bc687de243ab.png" src="../_images/0d090a8cf2734925c7cc8507b22c78aac2d09575496fe7ecad01bc687de243ab.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="random-forest-regression">
<h1>Random Forest Regression<a class="headerlink" href="#random-forest-regression" title="Link to this heading">#</a></h1>
<section id="id4">
<h2>Definición<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>Random Forest es un algoritmo de <strong>ensamble basado en árboles de decisión</strong>, que combina múltiples árboles de regresión (estimadores base) para mejorar la precisión y reducir el sobreajuste. Para regresión, el modelo final predice el valor promedio de todos los árboles individuales.</p>
</section>
<section id="prediccion">
<h2>Predicción<a class="headerlink" href="#prediccion" title="Link to this heading">#</a></h2>
<p>Dado un conjunto de <span class="math notranslate nohighlight">\(B\)</span> árboles de regresión <span class="math notranslate nohighlight">\(T_b\)</span>, la predicción del modelo Random Forest es:</p>
<div class="math notranslate nohighlight">
\[
\hat{y} = \frac{1}{B} \sum_{b=1}^{B} T_b(x)
\]</div>
<p>Donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x\)</span> es el vector de características,</p></li>
<li><p><span class="math notranslate nohighlight">\(T_b(x)\)</span> es la predicción del árbol <span class="math notranslate nohighlight">\(b\)</span>.</p></li>
</ul>
</section>
<section id="id5">
<h2>Características<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Utiliza <strong>bagging (Bootstrap Aggregation)</strong>: cada árbol se entrena con una muestra aleatoria del dataset.</p></li>
<li><p><strong>Submuestreo de características</strong> en cada división, lo que introduce diversidad entre árboles.</p></li>
<li><p>Reduce <strong>varianza</strong> respecto a un solo árbol (Decision Tree).</p></li>
<li><p>Inmune al sobreajuste en muchos casos si el número de árboles es suficientemente grande.</p></li>
<li><p>Puede capturar relaciones <strong>no lineales</strong> y <strong>interacciones entre variables</strong> sin necesidad de transformación previa.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">evaluar_rf_rolling_total_opt_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evalúa Random Forest optimizado sobre todos los folds generados.</span>
<span class="sd">    Devuelve DataFrame con métricas por fold y serie completa real vs predicha.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">jarque_bera</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">smape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="n">diff</span><span class="p">[</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">root_mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Evaluando modelo Random Forest (optimizado)...&quot;</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">resultados</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_true_full</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_pred_full</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_train&#39;</span><span class="p">]</span>
        <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_test&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span>

        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
            <span class="p">]),</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="p">])</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span>
                <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
            <span class="p">))</span>
        <span class="p">])</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span>

        <span class="c1"># Guardar para reconstruir la serie</span>
        <span class="n">y_true_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">y_pred_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

        <span class="n">resultados</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;fold&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;RMSE&quot;</span><span class="p">:</span> <span class="n">root_mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;MAE&quot;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;SMAPE&quot;</span><span class="p">:</span> <span class="n">smape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;Ljung_p&quot;</span><span class="p">:</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;lb_pvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;Jarque_p&quot;</span><span class="p">:</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">df_resultados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">)</span>

    <span class="n">y_true_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_true_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_pred_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="n">serie_completa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;Real&quot;</span><span class="p">:</span> <span class="n">y_true_total</span><span class="p">,</span>
        <span class="s2">&quot;Predicho&quot;</span><span class="p">:</span> <span class="n">y_pred_total</span>
    <span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Tiempo total: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inicio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Promedio de métricas:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_resultados</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df_resultados</span><span class="p">,</span> <span class="n">serie_completa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_rf</span><span class="p">,</span> <span class="n">serie_rf</span> <span class="o">=</span> <span class="n">evaluar_rf_rolling_total_opt_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Evaluando modelo Random Forest (optimizado)...

 Tiempo total: 12114.21 segundos

 Promedio de métricas:
fold        30965.0000
RMSE           28.1588
MAE            23.3584
SMAPE          59.1483
R2              0.6603
Ljung_p            NaN
Jarque_p        0.7844
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_rf</span><span class="p">[</span><span class="s2">&quot;Real&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_rf</span><span class="p">[</span><span class="s2">&quot;Predicho&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicho&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Random Forest - Real vs Predicho (Serie Completa)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/41a8e047bc52a550a8f6664dee59d3575aa433d94c277dff8dd6675e245ecb39.png" src="../_images/41a8e047bc52a550a8f6664dee59d3575aa433d94c277dff8dd6675e245ecb39.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="xgboost">
<h1>XGboost<a class="headerlink" href="#xgboost" title="Link to this heading">#</a></h1>
<section id="xgboost-regressor-definicion-matematica">
<h2>XGBoost Regressor: Definición Matemática<a class="headerlink" href="#xgboost-regressor-definicion-matematica" title="Link to this heading">#</a></h2>
<p><strong>XGBoost</strong> (eXtreme Gradient Boosting) es un algoritmo basado en árboles que emplea <strong>boosting por gradiente</strong> para construir un modelo fuerte a partir de múltiples árboles débiles.</p>
<section id="objetivo-del-modelo">
<h3>Objetivo del modelo<a class="headerlink" href="#objetivo-del-modelo" title="Link to this heading">#</a></h3>
<p>Dado un conjunto de datos:</p>
<div class="math notranslate nohighlight">
\[
\{(x_i, y_i)\}_{i=1}^n
\]</div>
<p>la predicción del modelo es:</p>
<div class="math notranslate nohighlight">
\[
\hat{y}_i = \sum_{k=1}^{K} f_k(x_i), \quad f_k \in \mathcal{F}
\]</div>
<p>Donde:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
f_k: \text{árbol de regresión número } k \\
\mathcal{F}: \text{espacio de funciones de todos los árboles posibles} \\
K: \text{número total de árboles}
\end{split}\]</div>
</section>
<section id="funcion-objetivo">
<h3>Función objetivo<a class="headerlink" href="#funcion-objetivo" title="Link to this heading">#</a></h3>
<p>XGBoost minimiza la siguiente función de pérdida regularizada:</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}^{(t)} = \sum_{i=1}^{n} l(y_i, \hat{y}_i^{(t)}) + \sum_{k=1}^{t} \Omega(f_k)
\]</div>
<p>Donde (l ) es una función de pérdida convexa (como el error cuadrático), y el término de regularización es:</p>
<div class="math notranslate nohighlight">
\[
\Omega(f) = \gamma T + \frac{1}{2} \lambda \sum_{j=1}^{T} w_j^2
\]</div>
<p>Con:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
T: \text{número de hojas del árbol} \\
w_j: \text{peso de la hoja } j \\
\gamma: \text{penalización por cada hoja (para poda)} \\
\lambda: \text{regularización L2 sobre los pesos}
\end{split}\]</div>
</section>
<section id="aproximacion-de-segundo-orden-expansion-de-taylor">
<h3>Aproximación de segundo orden (expansión de Taylor)<a class="headerlink" href="#aproximacion-de-segundo-orden-expansion-de-taylor" title="Link to this heading">#</a></h3>
<p>Para eficiencia computacional, se utiliza la siguiente aproximación:</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}^{(t)} \approx \sum_{i=1}^{n} \left[ g_i f_t(x_i) + \frac{1}{2} h_i f_t^2(x_i) \right] + \Omega(f_t)
\]</div>
<p>Donde:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
g_i = \frac{\partial l(y_i, \hat{y}_i^{(t-1)})}{\partial \hat{y}_i^{(t-1)}} \quad \text{(gradiente)} \\
h_i = \frac{\partial^2 l(y_i, \hat{y}_i^{(t-1)})}{\partial (\hat{y}_i^{(t-1)})^2} \quad \text{(hessiano)}
\end{split}\]</div>
</section>
<section id="ventajas-clave">
<h3>Ventajas clave<a class="headerlink" href="#ventajas-clave" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Manejo automático de valores faltantes</p></li>
<li><p>Poda eficiente basada en ganancia mínima</p></li>
<li><p>Optimización con histogramas (<code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code>)</p></li>
<li><p>Regularización L1 y L2 integrada</p></li>
<li><p>Soporte para early stopping y ejecución paralela</p></li>
</ul>
<p>** Conclusión:**<br />
XGBoost es un modelo altamente eficiente y preciso para tareas de regresión no lineal, ideal cuando los modelos lineales no capturan adecuadamente la complejidad del problema.</p>
</section>
</section>
<section id="optimizacion-de-xgboost-tree-method-hist-y-early-stopping-rounds">
<h2>Optimización de XGBoost: <code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code> y <code class="docutils literal notranslate"><span class="pre">early_stopping_rounds</span></code><a class="headerlink" href="#optimizacion-de-xgboost-tree-method-hist-y-early-stopping-rounds" title="Link to this heading">#</a></h2>
<p>XGBoost es reconocido por su eficiencia gracias a técnicas específicas de optimización. Las dos más relevantes aquí son:</p>
<section id="tree-method-hist-boosting-con-histogramas">
<h3>1. <code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code>: Boosting con histogramas<a class="headerlink" href="#tree-method-hist-boosting-con-histogramas" title="Link to this heading">#</a></h3>
<p>Este método discretiza las características continuas en <strong>bins</strong> (intervalos) y construye histogramas para acelerar la búsqueda de divisiones óptimas en cada nodo del árbol.</p>
</section>
<section id="proceso-matematico">
<h3>Proceso matemático:<a class="headerlink" href="#proceso-matematico" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Se agrupan los gradientes y hessianos dentro de cada bin ( B_k ) para una característica ( x_j ):</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\text{Histograma}(x_j) = \left\{ \sum_{i \in B_k} g_i, \sum_{i \in B_k} h_i \right\}_{k=1}^{K}
\]</div>
<p>Donde:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
B_k: \text{bin } k \text{ de la característica } x_j \\
g_i: \text{gradiente de la observación } i \\
h_i: \text{hessiano de la observación } i \\
K: \text{número total de bins}
\end{split}\]</div>
<ol class="arabic simple" start="2">
<li><p>La ganancia al dividir en un punto binario ( t ) se calcula como:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\text{Gain}(t) = \frac{1}{2} \left( \frac{G_L^2}{H_L + \lambda} + \frac{G_R^2}{H_R + \lambda} - \frac{(G_L + G_R)^2}{H_L + H_R + \lambda} \right) - \gamma
\]</div>
<p>Donde:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
G_L, H_L: \text{suma de gradientes y hessianos a la izquierda del punto de corte} \\
G_R, H_R: \text{suma de gradientes y hessianos a la derecha del punto de corte} \\
\lambda: \text{regularización L2} \\
\gamma: \text{penalización por cada nodo dividido}
\end{split}\]</div>
<p>Esta técnica reduce el costo computacional de ( \mathcal{O}(n \log n) ) a ( \mathcal{O}(n) ), ideal para grandes volúmenes de datos.</p>
</section>
<section id="early-stopping-rounds-detencion-temprana">
<h3>2. <code class="docutils literal notranslate"><span class="pre">early_stopping_rounds</span></code>: Detención temprana<a class="headerlink" href="#early-stopping-rounds-detencion-temprana" title="Link to this heading">#</a></h3>
<p>Este método evita el sobreentrenamiento al monitorear el desempeño del modelo en un conjunto de validación.</p>
</section>
<section id="criterio-formal">
<h3>Criterio formal:<a class="headerlink" href="#criterio-formal" title="Link to this heading">#</a></h3>
<p>Sea la pérdida en el conjunto de validación en la iteración ( t ):</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}_{\text{val}}^{(t)}
\]</div>
<p>El entrenamiento se detiene si durante ( R ) iteraciones consecutivas no se mejora la mejor pérdida registrada:</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}_{\text{val}}^{(t)} &gt; \min \left\{ \mathcal{L}_{\text{val}}^{(t-r)} \right\}_{r=1}^{R}
\]</div>
<p>Esto permite <strong>detener el entrenamiento automáticamente</strong> si el modelo no mejora en el conjunto de validación tras cierto número de rondas.</p>
</section>
<section id="conclusion">
<h3>Conclusión:<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code> acelera el entrenamiento usando histogramas optimizados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">early_stopping_rounds</span></code> evita sobreajuste al validar el error en cada iteración.</p></li>
<li><p>Combinadas, estas técnicas hacen de XGBoost una solución <strong>potente, escalable y segura</strong> para tareas de regresión sobre grandes datasets temporales.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">evaluar_xgboost_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">,</span> <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evalúa XGBoost con early stopping sobre folds rolling.</span>
<span class="sd">    Devuelve métricas por fold y serie real vs. predicho.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">xgboost</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xgb</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">jarque_bera</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">smape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="n">diff</span><span class="p">[</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">root_mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Evaluando modelo XGBoost (early stopping)...&quot;</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">resultados</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_true_full</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_pred_full</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_train&#39;</span><span class="p">]</span>
        <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_test&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span>

        <span class="c1"># División interna para early stopping</span>
        <span class="n">val_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">X_t</span><span class="p">,</span> <span class="n">X_val</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="o">-</span><span class="n">val_size</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[</span><span class="o">-</span><span class="n">val_size</span><span class="p">:]</span>
        <span class="n">y_t</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[:</span><span class="o">-</span><span class="n">val_size</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="o">-</span><span class="n">val_size</span><span class="p">:]</span>

        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
            <span class="p">]),</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="p">])</span>

        <span class="c1"># Preprocesamiento separado para train y val</span>
        <span class="n">X_t_proc</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_t</span><span class="p">)</span>
        <span class="n">X_val_proc</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
        <span class="n">X_test_proc</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span>
            <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">tree_method</span><span class="o">=</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span>
            <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="n">early_stopping_rounds</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
            <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_t_proc</span><span class="p">,</span> <span class="n">y_t</span><span class="p">,</span> <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_val_proc</span><span class="p">,</span> <span class="n">y_val</span><span class="p">)],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_proc</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span>

        <span class="n">y_true_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">y_pred_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

        <span class="n">resultados</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;fold&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;RMSE&quot;</span><span class="p">:</span> <span class="n">root_mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;MAE&quot;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;SMAPE&quot;</span><span class="p">:</span> <span class="n">smape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;Ljung_p&quot;</span><span class="p">:</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;lb_pvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;Jarque_p&quot;</span><span class="p">:</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">df_resultados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">)</span>

    <span class="n">y_true_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_true_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_pred_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="n">serie_completa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;Real&quot;</span><span class="p">:</span> <span class="n">y_true_total</span><span class="p">,</span>
        <span class="s2">&quot;Predicho&quot;</span><span class="p">:</span> <span class="n">y_pred_total</span>
    <span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Tiempo total: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inicio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Promedio de métricas:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_resultados</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df_resultados</span><span class="p">,</span> <span class="n">serie_completa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_xgb</span><span class="p">,</span> <span class="n">serie_xgb</span> <span class="o">=</span> <span class="n">evaluar_xgboost_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Evaluando modelo XGBoost (early stopping)...

 Tiempo total: 14454.76 segundos

 Promedio de métricas:
fold        30965.0000
RMSE           25.5797
MAE            21.0891
SMAPE          53.5796
R2              0.6992
Ljung_p            NaN
Jarque_p        0.7839
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_xgb</span><span class="p">[</span><span class="s2">&quot;Real&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_xgb</span><span class="p">[</span><span class="s2">&quot;Predicho&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicho&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;XGBoost - Real vs Predicho (Serie Completa)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b95f1ff5ad1f6971194fca612101c840fd785841a94005a2d3a1222b60caccfb.png" src="../_images/b95f1ff5ad1f6971194fca612101c840fd785841a94005a2d3a1222b60caccfb.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="support-vector-regression-svr">
<h1>Support Vector Regression (SVR)<a class="headerlink" href="#support-vector-regression-svr" title="Link to this heading">#</a></h1>
<section id="id6">
<h2>Definición<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<p>Support Vector Regression (SVR) es una extensión del algoritmo de Support Vector Machines (SVM) al contexto de regresión. En lugar de buscar una frontera de decisión como en clasificación, SVR busca encontrar una <strong>función que tenga como máximo un error ε</strong> para cada punto de entrenamiento, y al mismo tiempo sea lo más plana posible.</p>
</section>
<section id="formulacion-matematica">
<h2>Formulación matemática<a class="headerlink" href="#formulacion-matematica" title="Link to this heading">#</a></h2>
<p>SVR intenta resolver el siguiente problema de optimización:</p>
<p>Minimizar:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{2} \| \mathbf{w} \|^2 + C \sum_{i=1}^{n} (\xi_i + \xi_i^*)
\]</div>
<p>Sujeto a:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{cases}
y_i - \langle \mathbf{w}, \phi(x_i) \rangle - b \leq \varepsilon + \xi_i \\
\langle \mathbf{w}, \phi(x_i) \rangle + b - y_i \leq \varepsilon + \xi_i^* \\
\xi_i, \xi_i^* \geq 0
\end{cases}
\end{split}\]</div>
<p>Donde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( \phi(x_i) \)</span> es una transformación (implícita) al espacio de características de mayor dimensión (kernel trick),</p></li>
<li><p><span class="math notranslate nohighlight">\( \varepsilon \)</span> es el margen de tolerancia al error (epsilon-insensitive tube),</p></li>
<li><p><span class="math notranslate nohighlight">\( \xi_i, \xi_i^* \)</span> son variables de holgura que permiten errores fuera del margen,</p></li>
<li><p><span class="math notranslate nohighlight">\( C \)</span> es un hiperparámetro que controla el equilibrio entre la complejidad del modelo y la tolerancia al error,</p></li>
<li><p><span class="math notranslate nohighlight">\( \mathbf{w} \)</span> y <span class="math notranslate nohighlight">\( b \)</span> definen la función de regresión.</p></li>
</ul>
</section>
<section id="id7">
<h2>Intuición<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Los puntos que se encuentran dentro del “tubo” de <span class="math notranslate nohighlight">\( \varepsilon \)</span> <strong>no contribuyen a la función de pérdida</strong>.</p></li>
<li><p>Solo los puntos fuera del tubo generan penalización y se convierten en <strong>vectores de soporte</strong>.</p></li>
<li><p>El modelo busca una solución que <strong>minimice la complejidad</strong> (norma de <span class="math notranslate nohighlight">\( \mathbf{w} \)</span>) mientras mantiene <strong>errores dentro del margen</strong>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">evaluar_svr_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evalúa SVR optimizado sobre todos los folds y reconstruye serie completa.</span>
<span class="sd">    Retorna DataFrame de métricas y DataFrame con serie real vs. predicho.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.svm</span><span class="w"> </span><span class="kn">import</span> <span class="n">SVR</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnTransformer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">jarque_bera</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">smape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="n">diff</span><span class="p">[</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">root_mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Evaluando modelo SVR (optimizado)...&quot;</span><span class="p">)</span>
    <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">resultados</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_true_full</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_pred_full</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_train&#39;</span><span class="p">]</span>
        <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;X_test&#39;</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span>

        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
            <span class="p">]),</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="p">])</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;svr&#39;</span><span class="p">,</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">))</span>
        <span class="p">])</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span>

        <span class="n">y_true_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">y_pred_full</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

        <span class="n">resultados</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;fold&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;RMSE&quot;</span><span class="p">:</span> <span class="n">root_mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;MAE&quot;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;SMAPE&quot;</span><span class="p">:</span> <span class="n">smape</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;R2&quot;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s2">&quot;Ljung_p&quot;</span><span class="p">:</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;lb_pvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s2">&quot;Jarque_p&quot;</span><span class="p">:</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">})</span>

    <span class="n">df_resultados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resultados</span><span class="p">)</span>

    <span class="n">y_true_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_true_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">y_pred_full</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="n">serie_completa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;Real&quot;</span><span class="p">:</span> <span class="n">y_true_total</span><span class="p">,</span>
        <span class="s2">&quot;Predicho&quot;</span><span class="p">:</span> <span class="n">y_pred_total</span>
    <span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Tiempo total: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inicio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Promedio de métricas:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_resultados</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">df_resultados</span><span class="p">,</span> <span class="n">serie_completa</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_svr</span><span class="p">,</span> <span class="n">serie_svr</span> <span class="o">=</span> <span class="n">evaluar_svr_rolling_total_con_serie</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Evaluando modelo SVR (optimizado)...

 Tiempo total: 714.05 segundos

 Promedio de métricas:
fold        30965.0000
RMSE           66.3116
MAE            55.1974
SMAPE         112.8292
R2              0.1121
Ljung_p            NaN
Jarque_p        0.7829
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_svr</span><span class="p">[</span><span class="s2">&quot;Real&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_svr</span><span class="p">[</span><span class="s2">&quot;Predicho&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicho&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;SVR - Real vs Predicho (Serie Completa)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1f635f3b3f6a90730417ad61401ebef2964be4519ffa3f686cdd244d4cc68c2a.png" src="../_images/1f635f3b3f6a90730417ad61401ebef2964be4519ffa3f686cdd244d4cc68c2a.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="resultados">
<h1>Resultados<a class="headerlink" href="#resultados" title="Link to this heading">#</a></h1>
<section id="comparacion-final-de-modelos">
<h2>Comparación Final de Modelos<a class="headerlink" href="#comparacion-final-de-modelos" title="Link to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Modelo</p></th>
<th class="head"><p>RMSE</p></th>
<th class="head"><p>MAE</p></th>
<th class="head"><p>SMAPE</p></th>
<th class="head"><p>R²</p></th>
<th class="head"><p>Ljung_p</p></th>
<th class="head"><p>Jarque_p</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Ridge</strong></p></td>
<td><p>2.5695</p></td>
<td><p>2.1925</p></td>
<td><p>11.72</p></td>
<td><p>0.9944</p></td>
<td><p>NaN</p></td>
<td><p>0.7873</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Lasso</strong></p></td>
<td><p>2.6883</p></td>
<td><p>2.2930</p></td>
<td><p>13.72</p></td>
<td><p>0.9914</p></td>
<td><p>NaN</p></td>
<td><p>0.7873</p></td>
</tr>
<tr class="row-even"><td><p><strong>XGBoost</strong></p></td>
<td><p>25.5797</p></td>
<td><p>21.0891</p></td>
<td><p>53.58</p></td>
<td><p>0.6992</p></td>
<td><p>NaN</p></td>
<td><p>0.7839</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Random Forest</strong></p></td>
<td><p>28.1588</p></td>
<td><p>23.3584</p></td>
<td><p>59.15</p></td>
<td><p>0.6603</p></td>
<td><p>NaN</p></td>
<td><p>0.7844</p></td>
</tr>
<tr class="row-even"><td><p><strong>KNN</strong></p></td>
<td><p>36.2315</p></td>
<td><p>30.6235</p></td>
<td><p>80.67</p></td>
<td><p>0.4689</p></td>
<td><p>NaN</p></td>
<td><p>0.7857</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SVR</strong></p></td>
<td><p>66.3116</p></td>
<td><p>55.1974</p></td>
<td><p>112.82</p></td>
<td><p>0.1121</p></td>
<td><p>NaN</p></td>
<td><p>0.7829</p></td>
</tr>
</tbody>
</table>
</div>
<section id="justificacion-del-modelo-final">
<h3>Justificación del modelo final<a class="headerlink" href="#justificacion-del-modelo-final" title="Link to this heading">#</a></h3>
<p>Aunque el modelo <strong>Ridge Regression</strong> mostró el mejor rendimiento matemático (R² = 0.9944, RMSE = 2.56), estos valores pueden ser excesivamente optimistas. En series temporales financieras, es recomendable desconfiar de modelos que se ajustan con tanta perfección, especialmente si los errores son muy pequeños en comparación con la escala de la variable.</p>
<p>El modelo <strong>XGBoost</strong> ofreció un rendimiento más conservador pero <strong>realista y robusto</strong> (R² = 0.6992, RMSE = 25.57, SMAPE = 53.58), y por tanto <strong>se considera el modelo más confiable para generalizar en producción</strong>.</p>
</section>
<section id="por-que-los-p-valores-de-ljung-box-son-nan">
<h3>¿Por qué los p-valores de Ljung-Box son NaN?<a class="headerlink" href="#por-que-los-p-valores-de-ljung-box-son-nan" title="Link to this heading">#</a></h3>
<p>Este test requiere al menos 10 observaciones (lags) para calcular autocorrelación. Como el horizonte de predicción (<code class="docutils literal notranslate"><span class="pre">horizon=4</span></code>) genera solo 4 residuos por fold, <strong>no es estadísticamente posible aplicar el test</strong>. Esto no representa un error del modelo, sino una limitación del tamaño de ventana de validación.</p>
<p>Los residuos sí pasaron el test de normalidad (Jarque-Bera), con p-valores &gt; 0.78 en todos los casos.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="propuesta-de-modelo">
<h1>Propuesta de Modelo<a class="headerlink" href="#propuesta-de-modelo" title="Link to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="propuesta-ensemble-ridge-rf-xgboost-para-prediccion-del-precio-de-bitcoin">
<h1>Propuesta: Ensemble Ridge + RF + XGBoost para Predicción del Precio de Bitcoin<a class="headerlink" href="#propuesta-ensemble-ridge-rf-xgboost-para-prediccion-del-precio-de-bitcoin" title="Link to this heading">#</a></h1>
<section id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Link to this heading">#</a></h2>
<p>Se propone un modelo híbrido llamado <strong>Ensemble Ridge + RF + XGBoost</strong> para la predicción del comportamiento del precio del Bitcoin. Este enfoque combina tres modelos de naturaleza distinta con el objetivo de mejorar la capacidad predictiva en series financieras complejas como <code class="docutils literal notranslate"><span class="pre">Close_diff</span></code>. La estrategia del ensemble consiste en utilizar un promedio ponderado según el RMSE individual de cada modelo, logrando balance entre precisión, estabilidad y generalización.</p>
</section>
<section id="fundamentacion-teorica">
<h2>Fundamentación Teórica<a class="headerlink" href="#fundamentacion-teorica" title="Link to this heading">#</a></h2>
<section id="ridge-regression-l2">
<h3>1. Ridge Regression (L2)<a class="headerlink" href="#ridge-regression-l2" title="Link to this heading">#</a></h3>
<p>Modelo lineal con regularización que previene el sobreajuste y se comporta muy bien ante multicolinealidad. Aporta estabilidad y sirve como base confiable.</p>
</section>
<section id="random-forest">
<h3>2. Random Forest<a class="headerlink" href="#random-forest" title="Link to this heading">#</a></h3>
<p>Modelo de conjunto que captura relaciones no lineales y es resistente al ruido. Ideal para datos financieros con alta volatilidad.</p>
</section>
<section id="id8">
<h3>3. XGBoost<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<p>Modelo de boosting que corrige errores residuales iterativamente. Su capacidad de ajuste fino lo hace ideal para refinar predicciones en entornos complejos.</p>
</section>
<section id="estructura-del-modelo-ensemble">
<h3>Estructura del Modelo Ensemble<a class="headerlink" href="#estructura-del-modelo-ensemble" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Entrenamiento individual de Ridge, RF y XGBoost sobre los mismos pliegues rolling.</p></li>
<li><p>Predicción individual sobre las mismas ventanas.</p></li>
<li><p>Cálculo de pesos inversos al RMSE individual:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
w_i = \frac{1}{RMSE_i}
\]</div>
<ol class="arabic simple" start="4">
<li><p>Cálculo de la predicción final ponderada:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\hat{y}_{ensemble} = \frac{w_{ridge} \cdot \hat{y}_{ridge} + w_{rf} \cdot \hat{y}_{rf} + w_{xgb} \cdot \hat{y}_{xgb}}{w_{ridge} + w_{rf} + w_{xgb}}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">acorr_ljungbox</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">jarque_bera</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">smape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
    <span class="n">diff</span><span class="p">[</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">evaluar_ensemble_series</span><span class="p">(</span><span class="n">serie_ridge</span><span class="p">,</span> <span class="n">serie_rf</span><span class="p">,</span> <span class="n">serie_xgb</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula combinación ponderada de Ridge + RF + XGB y evalúa métricas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Asegurar que los índices coinciden</span>
    <span class="n">inter_idx</span> <span class="o">=</span> <span class="n">serie_ridge</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">serie_rf</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">serie_xgb</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">serie_ridge</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inter_idx</span><span class="p">,</span> <span class="s2">&quot;Real&quot;</span><span class="p">]</span>

    <span class="c1"># Predicciones de cada modelo</span>
    <span class="n">y_ridge</span> <span class="o">=</span> <span class="n">serie_ridge</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inter_idx</span><span class="p">,</span> <span class="s2">&quot;Predicho&quot;</span><span class="p">]</span>
    <span class="n">y_rf</span> <span class="o">=</span> <span class="n">serie_rf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inter_idx</span><span class="p">,</span> <span class="s2">&quot;Predicho&quot;</span><span class="p">]</span>
    <span class="n">y_xgb</span> <span class="o">=</span> <span class="n">serie_xgb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inter_idx</span><span class="p">,</span> <span class="s2">&quot;Predicho&quot;</span><span class="p">]</span>

    <span class="c1"># Calcular RMSE individuales</span>
    <span class="n">rmse_ridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_ridge</span><span class="p">))</span>
    <span class="n">rmse_rf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_rf</span><span class="p">))</span>
    <span class="n">rmse_xgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_xgb</span><span class="p">))</span>

    <span class="c1"># Pesos inversos al RMSE</span>
    <span class="n">w_ridge</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rmse_ridge</span>
    <span class="n">w_rf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rmse_rf</span>
    <span class="n">w_xgb</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rmse_xgb</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">w_ridge</span> <span class="o">+</span> <span class="n">w_rf</span> <span class="o">+</span> <span class="n">w_xgb</span>

    <span class="c1"># Predicción ponderada</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_ridge</span> <span class="o">*</span> <span class="n">w_ridge</span> <span class="o">+</span> <span class="n">y_rf</span> <span class="o">*</span> <span class="n">w_rf</span> <span class="o">+</span> <span class="n">y_xgb</span> <span class="o">*</span> <span class="n">w_xgb</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span>

    <span class="c1"># Evaluación final</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">smape_val</span> <span class="o">=</span> <span class="n">smape</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">ljung_p</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;lb_pvalue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">jb_p</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Mostrar resultados</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Resultados Ensemble (Ridge + RF + XGBoost)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE:   </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE:    </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SMAPE:  </span><span class="si">{</span><span class="n">smape_val</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R²:     </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ljung-Box p:   </span><span class="si">{</span><span class="n">ljung_p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera p: </span><span class="si">{</span><span class="n">jb_p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Graficar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicho (Ensemble)&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Ensemble - Real vs Predicho (Serie Completa)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Close_diff&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Real&quot;</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span> <span class="s2">&quot;Predicho&quot;</span><span class="p">:</span> <span class="n">y_pred</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ensemble</span> <span class="o">=</span> <span class="n">evaluar_ensemble_series</span><span class="p">(</span><span class="n">serie_ridge</span><span class="p">,</span> <span class="n">serie_rf</span><span class="p">,</span> <span class="n">serie_xgb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Resultados Ensemble (Ridge + RF + XGBoost)
RMSE:   8.5050
MAE:    3.7685
SMAPE:  15.50%
R²:     0.9954
Ljung-Box p:   0.0000
Jarque-Bera p: 0.0000
</pre></div>
</div>
<img alt="../_images/1e7e6ff46219ee108274219a604b9bbe44e90b2c860d9518a49cacb382fdbbe5.png" src="../_images/1e7e6ff46219ee108274219a604b9bbe44e90b2c860d9518a49cacb382fdbbe5.png" />
</div>
</div>
</section>
</section>
<section id="resultados-obtenidos">
<h2>Resultados Obtenidos<a class="headerlink" href="#resultados-obtenidos" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>RMSE:</strong> 8.5050</p></li>
<li><p><strong>MAE:</strong> 3.7685</p></li>
<li><p><strong>SMAPE:</strong> 15.50%</p></li>
<li><p><strong>R²:</strong> 0.9954</p></li>
<li><p><strong>Ljung-Box p-value:</strong> 0.0000</p></li>
<li><p><strong>Jarque-Bera p-value:</strong> 0.0000</p></li>
</ul>
</section>
<section id="interpretacion">
<h2>Interpretación<a class="headerlink" href="#interpretacion" title="Link to this heading">#</a></h2>
<p>El ensemble muestra una capacidad predictiva sobresaliente, con un <strong>R² de 0.9954</strong> y un <strong>SMAPE de solo 15.5%</strong>, superando ampliamente a los modelos individuales. La curva predicha reproduce con gran fidelidad la dinámica de <code class="docutils literal notranslate"><span class="pre">Close_diff</span></code> incluso en zonas de alta volatilidad, como se aprecia visualmente en el gráfico correspondiente.</p>
<p>No obstante, el análisis estadístico de los residuos reporta:</p>
<ul class="simple">
<li><p><strong>Autocorrelación significativa</strong> según el test de Ljung-Box (p = 0.0000).</p></li>
<li><p><strong>No normalidad</strong> según el test de Jarque-Bera (p = 0.0000).</p></li>
</ul>
<section id="como-se-interpreta-esto">
<h3>¿Cómo se interpreta esto?<a class="headerlink" href="#como-se-interpreta-esto" title="Link to this heading">#</a></h3>
<p>Estos resultados <strong>no descalifican el modelo</strong>, sino que reflejan características típicas de las series temporales financieras:</p>
<ul class="simple">
<li><p>Las predicciones están muy ajustadas, pero los residuos tienden a concentrarse en ráfagas de error estructural (volatilidad agrupada), algo común en series como la del Bitcoin.</p></li>
<li><p>La <strong>no normalidad</strong> puede explicarse por la presencia de valores extremos (jumps, shocks), sesgo direccional o asimetrías intrínsecas en el comportamiento de los activos.</p></li>
<li><p>La <strong>autocorrelación</strong> residual también puede surgir por efectos de corto plazo no modelados, como momentum o reversión, los cuales podrían abordarse mediante un modelo autoregresivo complementario.</p></li>
</ul>
</section>
<section id="por-que-el-modelo-sigue-siendo-valido">
<h3>¿Por qué el modelo sigue siendo válido?<a class="headerlink" href="#por-que-el-modelo-sigue-siendo-valido" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>La <strong>evaluación se centra en precisión predictiva</strong>, y el modelo demuestra resultados consistentemente superiores.</p></li>
<li><p>En contextos financieros, es habitual que modelos con alta precisión tengan residuos estructurados, ya que la serie original es altamente no estacionaria.</p></li>
<li><p>Este comportamiento sugiere que <strong>el modelo capta bien la señal principal</strong>, aunque <strong>parte del “ruido” contiene patrones menores no absorbidos</strong>.</p></li>
</ul>
<p>Por tanto, se considera que el ensemble cumple con su objetivo de <strong>maximizar la capacidad de predicción</strong> dentro de un marco multivariado realista, y se justifica su uso como modelo final con potencial para aplicaciones prácticas o futuras extensiones más profundas.</p>
</section>
</section>
<section id="id9">
<h2>Conclusión<a class="headerlink" href="#id9" title="Link to this heading">#</a></h2>
<p>El modelo <strong>Ensemble Ridge + RF + XGBoost</strong> se posiciona como el mejor de la propuesta actual, combinando precisión sobresaliente y arquitectura robusta. A pesar de las limitaciones estadísticas de los residuos, se justifica su selección como <strong>modelo final</strong> por su rendimiento superior y su capacidad para generalizar en contextos reales.</p>
<p>.</p>
</section>
<section id="conclusion-general">
<h2>Conclusión General<a class="headerlink" href="#conclusion-general" title="Link to this heading">#</a></h2>
<p>Predecir con exactitud el comportamiento del precio del Bitcoin es, en esencia, un desafío extremadamente complejo. Las criptomonedas presentan una dinámica altamente volátil, no lineal y sujeta a eventos externos impredecibles como noticias, regulaciones o comportamientos especulativos de mercado.</p>
<p>A pesar de estas dificultades, este proyecto demuestra que es posible construir modelos estadísticos y de aprendizaje automático que capturen ciertos patrones y permitan generar predicciones razonablemente precisas sobre el cambio de precio (<code class="docutils literal notranslate"><span class="pre">Close_diff</span></code>). En particular, el modelo Ensemble propuesto —que combina Ridge Regression, Random Forest y XGBoost— logra mejorar la estabilidad y robustez frente a modelos individuales, gracias a la integración de distintas perspectivas (lineal, no lineal y secuencial).</p>
<p>Se utilizaron técnicas apropiadas de preparación de datos, validación cruzada temporal (rolling windows), ingeniería de características temporales y evaluación rigurosa con métricas como RMSE, R², SMAPE, y pruebas estadísticas sobre residuos. A pesar de obtener altos valores de precisión en los datos de prueba, los resultados también revelan limitaciones: los residuos presentan evidencia de autocorrelación y no normalidad, lo que indica que aún hay componentes estocásticos no modelados por completo.</p>
<p>En conclusión, aunque no es posible anticipar perfectamente el precio del Bitcoin, los modelos desarrollados en este trabajo representan herramientas valiosas para aproximar su comportamiento en el corto plazo, con aplicaciones potenciales en análisis cuantitativo, gestión de riesgo y estrategias de inversión algorítmica.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Predicción del Precio de Bitcoin con Modelos de Machine Learning</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">EDA BITCOIN</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#que-es-bitcoin">¿Qué es BITCOIN?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descripcion-de-los-datos">Descripción de los datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objetivo-del-analisis">Objetivo del análisis</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-datos-bitcoin">Análisis exploratorio de datos - BITCOIN</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-preliminar">Análisis preliminar</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizacion-de-la-serie">Visualización de la serie</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizacion-temporal">Visualización temporal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-la-volatilidad-intradia">Análisis de la volatilidad intradía</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretacion-del-precio-de-cierre-y-volumen-de-bitcoin">Interpretación del Precio de Cierre y Volumen de Bitcoin</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-estacionalidad-y-periodicidad-frecuencia-1-dia">Análisis de Estacionalidad y Periodicidad (Frecuencia: 1 día)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deteccion-de-anomalias">Detección de Anomalías</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-tendencia">Análisis de tendencia</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-autocorrelacion">Análisis de autocorrelación</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-estacionaridad">Análisis de Estacionaridad</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformacion-de-datos">Transformación de datos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-estacionaridad-variables-predictoras">Análisis de estacionaridad variables predictoras</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones-finales-eda">Conclusiones finales EDA</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implementacion-de-modelos">Implementación de Modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prediccion-del-precio-de-cierre-del-bitcoin-frecuencia-15-min">Predicción del Precio de Cierre del Bitcoin (Frecuencia: 15 min)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacion-de-modelos-benchmark">Aplicacion de modelos BenchMark</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preparacion-de-los-datos">Preparacion de los datos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enriquecimiento-del-dataframe-transformar-features-temporales">1. Enriquecimiento del DataFrame: <code class="docutils literal notranslate"><span class="pre">transformar_features_temporales()</span></code></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nearest-neighbors-knn">K-Nearest Neighbors (KNN)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion-general">Definición General</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caracteristicas-clave">Características Clave</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacion-matematica">Aplicación Matemática</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas-de-distancia-comunes">Métricas de Distancia Comunes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizacion-para-knn">Optimización para KNN</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-regression">Ridge Regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion">Definición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#intuicion">Intuición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#caracteristicas">Características</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solucion-cerrada">Solución cerrada</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacion">Aplicación</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso-regression-regresion-l1">Lasso Regression (Regresión L1)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Definición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Intuición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Características clave</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizacion-matematica-con-solver-saga-para-ridge-y-lasso">Optimización matemática con solver ‘saga’ para Ridge y Lasso</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#que-es-saga">¿Qué es ‘saga’?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#formulacion-general-del-problema-optimizado">Formulación general del problema optimizado</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-penalizacion-l2">Ridge (penalización L2):</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso-penalizacion-l1">Lasso (penalización L1):</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#que-optimiza-saga">¿Qué optimiza SAGA?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ventajas-del-solver-saga">Ventajas del solver ‘saga’:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-regression">Random Forest Regression</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Definición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prediccion">Predicción</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Características</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost">XGboost</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xgboost-regressor-definicion-matematica">XGBoost Regressor: Definición Matemática</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#objetivo-del-modelo">Objetivo del modelo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-objetivo">Función objetivo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aproximacion-de-segundo-orden-expansion-de-taylor">Aproximación de segundo orden (expansión de Taylor)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ventajas-clave">Ventajas clave</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizacion-de-xgboost-tree-method-hist-y-early-stopping-rounds">Optimización de XGBoost: <code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code> y <code class="docutils literal notranslate"><span class="pre">early_stopping_rounds</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-method-hist-boosting-con-histogramas">1. <code class="docutils literal notranslate"><span class="pre">tree_method='hist'</span></code>: Boosting con histogramas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proceso-matematico">Proceso matemático:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#early-stopping-rounds-detencion-temprana">2. <code class="docutils literal notranslate"><span class="pre">early_stopping_rounds</span></code>: Detención temprana</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criterio-formal">Criterio formal:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusión:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#support-vector-regression-svr">Support Vector Regression (SVR)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Definición</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#formulacion-matematica">Formulación matemática</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Intuición</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados">Resultados</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparacion-final-de-modelos">Comparación Final de Modelos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#justificacion-del-modelo-final">Justificación del modelo final</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#por-que-los-p-valores-de-ljung-box-son-nan">¿Por qué los p-valores de Ljung-Box son NaN?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#propuesta-de-modelo">Propuesta de Modelo</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#propuesta-ensemble-ridge-rf-xgboost-para-prediccion-del-precio-de-bitcoin">Propuesta: Ensemble Ridge + RF + XGBoost para Predicción del Precio de Bitcoin</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducción</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fundamentacion-teorica">Fundamentación Teórica</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-regression-l2">1. Ridge Regression (L2)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">2. Random Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">3. XGBoost</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-del-modelo-ensemble">Estructura del Modelo Ensemble</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-obtenidos">Resultados Obtenidos</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretacion">Interpretación</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#como-se-interpreta-esto">¿Cómo se interpreta esto?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#por-que-el-modelo-sigue-siendo-valido">¿Por qué el modelo sigue siendo válido?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Conclusión</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-general">Conclusión General</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Eliana Fuentes y Maria Camila Vargas
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>